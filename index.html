<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√°o Gi√° & Gi√° Th√†nh Pro - Hi·ªán ƒê·∫°i</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">

    <link rel="stylesheet" href="style.css"> 
    
    <!-- C√ÅC TH∆Ø VI·ªÜN B√äN TH·ª® BA -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
</head>
<body class="app-body">
    <!-- Modal ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω -->
    <div id="auth-modal" class="auth-modal-overlay" style="display: none;">
        <div class="auth-modal-content">
            <div id="auth-forms-container">
                <!-- Form ƒêƒÉng nh·∫≠p -->
                <form id="login-form">
                    <h2>ƒêƒÉng Nh·∫≠p</h2>
                    <p>ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c c√¥ng vi·ªác c·ªßa b·∫°n.</p>
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" required title="Nh·∫≠p ƒë·ªãa ch·ªâ email ƒë√£ ƒëƒÉng k√Ω.">
                    </div>
                    <div class="form-group">
                        <label for="login-password">M·∫≠t kh·∫©u</label>
                        <div class="password-wrapper">
                            <input type="password" id="login-password" required title="Nh·∫≠p m·∫≠t kh·∫©u c·ªßa b·∫°n.">
                            <button type="button" id="toggle-login-password" class="password-toggle" aria-label="Hi·ªán m·∫≠t kh·∫©u">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <div class="form-group form-group-checkbox">
                        <input type="checkbox" id="remember-me" title="Ch·ªçn ƒë·ªÉ ghi nh·ªõ th√¥ng tin ƒëƒÉng nh·∫≠p cho l·∫ßn sau.">
                        <label for="remember-me">Ghi nh·ªõ ƒëƒÉng nh·∫≠p</label>
                    </div>
                    <p id="login-error" class="error-message"></p>
                    <button type="submit" title="Nh·∫•n ƒë·ªÉ ƒëƒÉng nh·∫≠p v√†o ·ª©ng d·ª•ng.">ƒêƒÉng Nh·∫≠p</button>
                    <p class="auth-switch">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" id="show-signup" title="Chuy·ªÉn sang form ƒëƒÉng k√Ω t√†i kho·∫£n m·ªõi.">ƒêƒÉng k√Ω ngay</a></p>
                    <p class="auth-switch" style="margin-top: 5px;"><a href="#" id="forgot-password-link" title="Y√™u c·∫ßu g·ª≠i email ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u n·∫øu b·∫°n qu√™n.">Qu√™n m·∫≠t kh·∫©u?</a></p>
                </form>

                <!-- Form ƒêƒÉng k√Ω -->
                <form id="signup-form" style="display: none;">
                    <h2>ƒêƒÉng K√Ω</h2>
                    <p>T·∫°o t√†i kho·∫£n ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu an to√†n.</p>
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" required title="Nh·∫≠p ƒë·ªãa ch·ªâ email b·∫°n mu·ªën d√πng ƒë·ªÉ ƒëƒÉng k√Ω.">
                    </div>
                    <div class="form-group">
                        <label for="signup-password">M·∫≠t kh·∫©u (√≠t nh·∫•t 6 k√Ω t·ª±)</label>
                        <input type="password" id="signup-password" required title="T·∫°o m·∫≠t kh·∫©u cho t√†i kho·∫£n, y√™u c·∫ßu t·ªëi thi·ªÉu 6 k√Ω t·ª±.">
                    </div>
                    <p id="signup-error" class="error-message"></p>
                    <button type="submit" title="Ho√†n t·∫•t vi·ªác ƒëƒÉng k√Ω t√†i kho·∫£n m·ªõi.">ƒêƒÉng K√Ω</button>
                    <p class="auth-switch">ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" id="show-login" title="Chuy·ªÉn v·ªÅ form ƒëƒÉng nh·∫≠p n·∫øu b·∫°n ƒë√£ c√≥ t√†i kho·∫£n.">ƒêƒÉng nh·∫≠p</a></p>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Th√¥ng b√°o H·∫øt h·∫°n -->
    <div id="expiration-modal" class="auth-modal-overlay" style="display: none;">
        <div class="auth-modal-content">
            <h2>T√†i Kho·∫£n ƒê√£ H·∫øt H·∫°n</h2>
            <p>R·∫•t ti·∫øc, t√†i kho·∫£n c·ªßa b·∫°n ƒë√£ h·∫øt h·∫°n s·ª≠ d·ª•ng. Vui l√≤ng li√™n h·ªá qu·∫£n tr·ªã vi√™n ƒë·ªÉ gia h·∫°n v√† ti·∫øp t·ª•c s·ª≠ d·ª•ng d·ªãch v·ª•.</p>
            <p>To√†n b·ªô d·ªØ li·ªáu c·ªßa b·∫°n v·∫´n ƒë∆∞·ª£c l∆∞u tr·ªØ an to√†n.</p>
            <button id="logout-expired-button" class="delete-btn" title="ƒêƒÉng xu·∫•t kh·ªèi t√†i kho·∫£n ƒë√£ h·∫øt h·∫°n.">ƒêƒÉng xu·∫•t</button>
        </div>
    </div>

    <!-- N·ªôi dung ch√≠nh c·ªßa ·ª©ng d·ª•ng -->
    
    <div id="app-container" class="container" style="display: none;">
        <header class="app-header">
            <h1>B√°o gi√° & Gi√° th√†nh Pro</h1>
            <div id="auth-container" class="no-print">
                <button id="globalDarkModeToggleButton" class="small-btn dark-mode-toggle-global" title="Chuy·ªÉn ch·∫ø ƒë·ªô t·ªëi">üåô</button>
                <div class="user-avatar">üë§</div>
                <div id="user-info">
                    <p id="auth-status">ƒêang k·∫øt n·ªëi...</p>
                    <button id="logoutButton" style="display:none;" class="delete-btn small-btn" title="ƒêƒÉng xu·∫•t kh·ªèi t√†i kho·∫£n hi·ªán t·∫°i.">ƒê.Xu·∫•t</button>
                </div>
            </div>
        </header>

        <nav class="tabs no-print">
            <button class="tab-button active" data-tab="tabQuote" title="So·∫°n th·∫£o v√† qu·∫£n l√Ω b√°o gi√° chi ti·∫øt cho kh√°ch h√†ng.">B√°o Gi√°</button>
            <button class="tab-button" data-tab="tabCosting" title="T√≠nh to√°n gi√° th√†nh s·∫£n ph·∫©m d·ª±a tr√™n chi ph√≠ v·∫≠t t∆∞, nh√¢n c√¥ng v√† c√°c chi ph√≠ kh√°c.">Gi√° Th√†nh</button>
            <button class="tab-button" data-tab="tabSavedQuotes" title="Xem l·∫°i, qu·∫£n l√Ω v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i c√°c b√°o gi√° ƒë√£ l∆∞u.">BG ƒê√£ L∆∞u</button>
            <button class="tab-button" data-tab="tabCatalog" title="Qu·∫£n l√Ω danh m·ª•c s·∫£n ph·∫©m/d·ªãch v·ª• v√† th∆∞ vi·ªán v·∫≠t t∆∞.">Qu·∫£n L√Ω DM</button>
            <button class="tab-button" data-tab="tabTemplateManagement" title="Qu·∫£n l√Ω c√°c m·∫´u b√°o gi√° v√† phi·∫øu t√≠nh gi√° th∆∞·ªùng d√πng.">Qu·∫£n L√Ω M·∫´u</button>
            <button class="tab-button" data-tab="tabSettings" title="C√†i ƒë·∫∑t th√¥ng tin c√¥ng ty, t√πy ch·ªânh hi·ªÉn th·ªã PDF v√† qu·∫£n l√Ω t√†i kho·∫£n.">C√†i ƒê·∫∑t</button>
            <button class="tab-button" data-tab="tabAdmin" id="admin-tab" style="display: none;" title="Khu v·ª±c qu·∫£n tr·ªã d√†nh cho Admin ƒë·ªÉ qu·∫£n l√Ω t√†i kho·∫£n ng∆∞·ªùi d√πng.">Qu·∫£n tr·ªã</button>
        </nav>
        
        <!-- Tab B√°o Gi√° -->
        <main id="tabQuote" class="tab-content active" role="tabpanel" aria-labelledby="tabQuoteButton">
            <section class="quote-general-info">
                <h2>Th√¥ng tin Chung B√°o gi√°</h2>
                <div class="form-group-inline" style="justify-content: flex-start; margin-bottom: 15px;">
                    <label for="createQuoteFromTemplateSelect" style="margin-right: 5px;">T·∫°o BG t·ª´ M·∫´u:</label>
                    <select id="createQuoteFromTemplateSelect" style="max-width: 300px;" title="Ch·ªçn m·ªôt m·∫´u b√°o gi√° ƒë√£ l∆∞u ƒë·ªÉ nhanh ch√≥ng t·∫°o b√°o gi√° m·ªõi.">
                        <option value="">-- Ch·ªçn m·∫´u b√°o gi√° --</option>
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
                <div class="item-grid">
                    <div class="form-group">
                        <label for="customerName">T√™n Kh√°ch h√†ng:</label>
                        <input type="text" id="customerName" title="Nh·∫≠p t√™n ƒë·∫ßy ƒë·ªß c·ªßa kh√°ch h√†ng ho·∫∑c c√¥ng ty.">
                    </div>
                    <div class="form-group">
                        <label for="customerAddress">ƒê·ªãa ch·ªâ:</label>
                        <input type="text" id="customerAddress" title="Nh·∫≠p ƒë·ªãa ch·ªâ li√™n h·ªá c·ªßa kh√°ch h√†ng.">
                    </div>
                    <div class="form-group">
                        <label for="quoteDate">Ng√†y b√°o gi√°:</label>
                        <input type="date" id="quoteDate" title="Ch·ªçn ng√†y l·∫≠p b√°o gi√°. M·∫∑c ƒë·ªãnh l√† ng√†y hi·ªán t·∫°i.">
                    </div>
                </div>
            </section>

            <hr class="no-print section-divider">
            <section id="quoteItemEntryForm" class="no-print item-entry-form-box">
                <h3>Th√™m/S·ª≠a chi ti·∫øt H·∫°ng m·ª•c B√°o gi√°:</h3>
                <input type="hidden" id="editingQuoteItemIdForm">

                <div class="form-section">
                    <h4>Th√¥ng tin C∆° b·∫£n & Danh m·ª•c</h4>
                    <div class="form-group">
                        <label for="quoteItemMainCategoryInput">Ch·ªçn ho·∫∑c nh·∫≠p Danh m·ª•c ch√≠nh:</label>
                        <input type="text" id="quoteItemMainCategoryInput" list="mainCategoryDataList" placeholder="Ch·ªçn ho·∫∑c g√µ ƒë·ªÉ t·∫°o DM ch√≠nh m·ªõi..." title="Ch·ªçn t·ª´ danh m·ª•c ch√≠nh hi·ªán c√≥ ho·∫∑c g√µ t√™n m·ªõi ƒë·ªÉ t·∫°o nhanh. Gi√∫p ph√¢n lo·∫°i h·∫°ng m·ª•c trong b√°o gi√°.">
                        <datalist id="mainCategoryDataList"></datalist>
                    </div>
                    <div class="form-group" style="position: relative;">
                        <label for="itemNameQuoteForm">T√™n H·∫°ng m·ª•c (g√µ ƒë·ªÉ t√¨m g·ª£i √Ω t·ª´ DM ho·∫∑c Phi·∫øu Gi√° Th√†nh):</label>
                        <input type="text" id="itemNameQuoteForm" placeholder="V√≠ d·ª•: S∆°n Nippon, T·ªß b·∫øp MDF" title="G√µ ƒë·ªÉ t√¨m t√™n h·∫°ng m·ª•c t·ª´ Danh m·ª•c ƒë√£ l∆∞u ho·∫∑c t·ª´ c√°c Phi·∫øu T√≠nh Gi√° ƒë√£ t·∫°o. Ch·ªçn m·ªôt g·ª£i √Ω s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn c√°c th√¥ng tin li√™n quan.">
                        <div id="itemNameSuggestionsContainer" class="suggestions-container"></div>
                    </div>
                    <div class="form-group">
                        <label for="itemSpecQuoteForm">Quy c√°ch/M√¥ t·∫£ chi ti·∫øt:</label>
                        <textarea id="itemSpecQuoteForm" rows="2" placeholder="V√≠ d·ª•: Lo·∫°i A, m√†u X, b√≥ng m·ªù..." title="M√¥ t·∫£ chi ti·∫øt c√°c th√¥ng s·ªë k·ªπ thu·∫≠t, v·∫≠t li·ªáu, m√†u s·∫Øc, ki·ªÉu d√°ng c·ªßa h·∫°ng m·ª•c."></textarea>
                    </div>
                </div>
                <hr class="form-section-divider-subtle">
                <div class="form-section">
                    <h4>Chi ti·∫øt ƒê∆°n gi√° & T√≠nh to√°n</h4>
                    <div class="item-grid">
                        <div class="form-group">
                            <label for="itemUnitQuoteForm">ƒê∆°n v·ªã t√≠nh:</label>
                            <input type="text" id="itemUnitQuoteForm" placeholder="V√≠ d·ª•: m¬≤, c√°i" title="ƒê∆°n v·ªã t√≠nh cho h·∫°ng m·ª•c n√†y (v√≠ d·ª•: m¬≤, c√°i, b·ªô, kg, md).">
                        </div>
                        <div class="form-group">
                            <label for="itemPriceQuoteForm">ƒê∆°n gi√° (VNƒê):</label>
                            <input type="number" id="itemPriceQuoteForm" placeholder="0" min="0" title="ƒê∆°n gi√° g·ªëc c·ªßa h·∫°ng m·ª•c theo ƒêVT (ch∆∞a bao g·ªìm gi·∫£m gi√° h·∫°ng m·ª•c).">
                        </div>
                         <div class="form-group">
                            <label for="itemDiscountValueForm">
                                Gi·∫£m gi√° h·∫°ng m·ª•c:
                                <span class="help-icon" title="Nh·∫≠p gi√° tr·ªã gi·∫£m gi√° cho h·∫°ng m·ª•c n√†y. C√≥ th·ªÉ l√† % c·ªßa ƒë∆°n gi√° ho·∫∑c m·ªôt s·ªë ti·ªÅn c·ªë ƒë·ªãnh (VNƒê). N·∫øu ƒë∆°n gi√° l√† 100.000, gi·∫£m 10% s·∫Ω th√†nh 90.000. Gi·∫£m 5.000 VNƒê s·∫Ω th√†nh 95.000."><svg class="icon-svg icon-help" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 15A7 7 0 108 1a7 7 0 000 14zm0 1A8 8 0 108 0a8 8 0 000 16z"/><path d="M5.255 5.786a.237.237 0 00.241.247h.825c.138 0 .248-.11.248-.247V5.3c0-.138-.11-.247-.248-.247h-.825a.237.237 0 00-.241.247v.486zm0 0v-.505c0-.67.55-1.214 1.223-1.214h.022c.673 0 1.223.545 1.223 1.214v.305c0 .114.075.21.176.234l.308.077c.333.083.588.37.588.713v.39c0 .417-.34.757-.757.757h-.653c-.367 0-.67-.27-.72-.625a.262.262 0 00-.26-.23H6.023c-.373 0-.675.29-.675.648v.3c0 .346.28.626.626.626h.93v1.36h-.16c-.39 0-.707.317-.707.707v.353c0 .39.317.707.707.707h.16V13h.825c.138 0 .248-.11.248-.247V11.85c0-.138-.11-.247-.248-.247h-.825v-1.15c0-.39-.316-.707-.707-.707H6.023c-.673 0-1.223-.545-1.223-1.214v-.3c0-.36.253-.665.587-.723l.244-.04zm1.969.57H6.023c-.14 0-.253.11-.253.25v.3c0 .138.112.25.253.25h1.201c.14 0 .253-.112.253-.25v-.3c0-.14-.113-.25-.253-.25z"/></svg></span>
                            </label>
                            <div class="input-group">
                                <input type="number" id="itemDiscountValueForm" value="0" min="0" title="Gi√° tr·ªã gi·∫£m gi√° cho ri√™ng h·∫°ng m·ª•c n√†y. C√≥ th·ªÉ l√† % ho·∫∑c s·ªë ti·ªÅn c·ªë ƒë·ªãnh.">
                                <select id="itemDiscountTypeForm" class="input-group-select" title="Ch·ªçn lo·∫°i gi·∫£m gi√° cho h·∫°ng m·ª•c: theo ph·∫ßn trƒÉm (%) c·ªßa ƒë∆°n gi√° ho·∫∑c m·ªôt s·ªë ti·ªÅn c·ªë ƒë·ªãnh (VNƒê).">
                                    <option value="percent">%</option>
                                    <option value="amount">VNƒê</option>
                                </select>
                            </div>
                        </div>
                         <div class="form-group">
                            <label for="itemCalcTypeQuoteForm">
                                C√°ch t√≠nh gi√°:
                                <span class="help-icon" title="Theo ƒê∆°n v·ªã: Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x S·ªë l∆∞·ª£ng. Theo Chi·ªÅu d√†i: Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x (D√†i/1000) x S·ªë l∆∞·ª£ng. ƒê∆°n gi√° t√≠nh theo m√©t. Theo Di·ªán t√≠ch: Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x (D√†i/1000) x (Cao/1000) x S·ªë l∆∞·ª£ng. ƒê∆°n gi√° t√≠nh theo m√©t vu√¥ng. Theo Th·ªÉ t√≠ch: Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x (D√†i/1000) x (Cao/1000) x (S√¢u/1000) x S·ªë l∆∞·ª£ng. ƒê∆°n gi√° t√≠nh theo m√©t kh·ªëi."><svg class="icon-svg icon-help" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 15A7 7 0 108 1a7 7 0 000 14zm0 1A8 8 0 108 0a8 8 0 000 16z"/><path d="M5.255 5.786a.237.237 0 00.241.247h.825c.138 0 .248-.11.248-.247V5.3c0-.138-.11-.247-.248-.247h-.825a.237.237 0 00-.241.247v.486zm0 0v-.505c0-.67.55-1.214 1.223-1.214h.022c.673 0 1.223.545 1.223 1.214v.305c0 .114.075.21.176.234l.308.077c.333.083.588.37.588.713v.39c0 .417-.34.757-.757.757h-.653c-.367 0-.67-.27-.72-.625a.262.262 0 00-.26-.23H6.023c-.373 0-.675.29-.675.648v.3c0 .346.28.626.626.626h.93v1.36h-.16c-.39 0-.707.317-.707.707v.353c0 .39.317.707.707.707h.16V13h.825c.138 0 .248-.11.248-.247V11.85c0-.138-.11-.247-.248-.247h-.825v-1.15c0-.39-.316-.707-.707-.707H6.023c-.673 0-1.223-.545-1.223-1.214v-.3c0-.36.253-.665.587-.723l.244-.04zm1.969.57H6.023c-.14 0-.253.11-.253.25v.3c0 .138.112.25.253.25h1.201c.14 0 .253-.112.253-.25v-.3c0-.14-.113-.25-.253-.25z"/></svg></span>
                            </label>
                            <select id="itemCalcTypeQuoteForm" title="Ch·ªçn c√°ch th·ª©c t√≠nh to√°n kh·ªëi l∆∞·ª£ng/th√†nh ti·ªÅn cho h·∫°ng m·ª•c n√†y.">
                                <option value="unit" title="Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x S·ªë l∆∞·ª£ng. Kh√¥ng s·ª≠ d·ª•ng k√≠ch th∆∞·ªõc ƒë·ªÉ t√≠nh kh·ªëi l∆∞·ª£ng.">Theo ƒê∆°n v·ªã (Gi√° x SL)</option>
                                <option value="length" title="Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x (D√†i/1000) x S·ªë l∆∞·ª£ng. ƒê∆°n gi√° t√≠nh theo m√©t.">Theo Chi·ªÅu d√†i (Gi√° x D√†i x SL)</option>
                                <option value="area" title="Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x (D√†i/1000) x (Cao/1000) x S·ªë l∆∞·ª£ng. ƒê∆°n gi√° t√≠nh theo m√©t vu√¥ng.">Theo Di·ªán t√≠ch (Gi√° x D√†i x Cao x SL)</option>
                                <option value="volume" title="Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x (D√†i/1000) x (Cao/1000) x (S√¢u/1000) x S·ªë l∆∞·ª£ng. ƒê∆°n gi√° t√≠nh theo m√©t kh·ªëi.">Theo Th·ªÉ t√≠ch (Gi√° x D√†i x Cao x S√¢u x SL)</option>
                            </select>
                        </div>
                    </div>
                
                    <div class="item-grid-col4 dimensions-group">
                         <div class="form-group dimension-input-group" id="groupItemLengthQuoteForm">
                            <label for="itemLengthQuoteForm">D√†i (mm):</label>
                            <input type="number" id="itemLengthQuoteForm" placeholder="N·∫øu c√≥" min="0" step="0.01" title="K√≠ch th∆∞·ªõc chi·ªÅu d√†i c·ªßa h·∫°ng m·ª•c, t√≠nh b·∫±ng milim√©t (mm). S·∫Ω ƒë∆∞·ª£c quy ƒë·ªïi sang m√©t khi t√≠nh kh·ªëi l∆∞·ª£ng n·∫øu c√°ch t√≠nh gi√° l√† theo Chi·ªÅu d√†i, Di·ªán t√≠ch ho·∫∑c Th·ªÉ t√≠ch.">
                        </div>
                        <div class="form-group dimension-input-group" id="groupItemHeightQuoteForm">
                            <label for="itemHeightQuoteForm">Cao (mm):</label> <input type="number" id="itemHeightQuoteForm" placeholder="N·∫øu c√≥" min="0" step="0.01" title="K√≠ch th∆∞·ªõc chi·ªÅu cao/r·ªông c·ªßa h·∫°ng m·ª•c, t√≠nh b·∫±ng milim√©t (mm). S·∫Ω ƒë∆∞·ª£c quy ƒë·ªïi sang m√©t khi t√≠nh kh·ªëi l∆∞·ª£ng n·∫øu c√°ch t√≠nh gi√° l√† theo Di·ªán t√≠ch ho·∫∑c Th·ªÉ t√≠ch.">
                        </div>
                        <div class="form-group dimension-input-group" id="groupItemDepthQuoteForm">
                            <label for="itemDepthQuoteForm">S√¢u (mm):</label> <input type="number" id="itemDepthQuoteForm" placeholder="N·∫øu c√≥" min="0" step="0.01" title="K√≠ch th∆∞·ªõc chi·ªÅu s√¢u/d√†y c·ªßa h·∫°ng m·ª•c, t√≠nh b·∫±ng milim√©t (mm). S·∫Ω ƒë∆∞·ª£c quy ƒë·ªïi sang m√©t khi t√≠nh kh·ªëi l∆∞·ª£ng n·∫øu c√°ch t√≠nh gi√° l√† theo Th·ªÉ t√≠ch.">
                        </div>
                         <div class="form-group">
                            <label for="itemQuantityQuoteForm">S·ªë l∆∞·ª£ng (b·ªô/c√°i):</label>
                            <input type="number" id="itemQuantityQuoteForm" value="1" min="0.01" step="0.01" title="S·ªë l∆∞·ª£ng c·ªßa h·∫°ng m·ª•c n√†y.">
                        </div>
                    </div>
                </div>

                <hr class="form-section-divider-subtle">
                
                <details class="form-section-collapsible">
                    <summary class="form-section-summary">
                        <h4>Th√¥ng tin B·ªï sung (·∫¢nh, Ghi ch√∫)</h4>
                        <svg class="summary-toggle-svg" viewBox="0 0 16 16"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>
                    </summary>
                    <div class="form-section-content">
                        <div class="item-grid">
                            <div class="form-group">
                                <label for="itemImageFileQuoteForm">·∫¢nh minh h·ªça (t·ªëi ƒëa 500KB):</label>
                                <input type="file" id="itemImageFileQuoteForm" accept="image/png, image/jpeg, image/gif, image/webp" class="file-input" title="Ch·ªçn m·ªôt file ·∫£nh ƒë·ªÉ hi·ªÉn th·ªã trong b√°o gi√°.">
                                <img id="itemImagePreviewQuoteForm" src="#" alt="Xem tr∆∞·ªõc ·∫£nh" class="image-preview">
                                <button type="button" id="removeItemImageButtonQuoteForm" class="small-btn delete-btn" style="display: none; margin-top: 8px;">X√≥a ·∫£nh</button>
                            </div>
                            <div class="form-group">
                                <label for="itemNotesQuoteForm">Ghi ch√∫ ri√™ng cho h·∫°ng m·ª•c:</label>
                                <textarea id="itemNotesQuoteForm" rows="3" placeholder="V√≠ d·ª•: B·∫£o h√†nh 2 nƒÉm, bao g·ªìm v·∫≠n chuy·ªÉn..." title="Th√™m c√°c ghi ch√∫, ƒëi·ªÅu kho·∫£n, ho·∫∑c th√¥ng tin b·∫£o h√†nh c·ª• th·ªÉ cho h·∫°ng m·ª•c n√†y."></textarea>
                            </div>
                        </div>
                    </div>
                </details>

                <div class="form-actions" style="margin-top: 20px;">
                    <button id="addOrUpdateItemButtonForm" class="primary-action-btn" title="Th√™m h·∫°ng m·ª•c m·ªõi v√†o b√°o gi√° ho·∫∑c c·∫≠p nh·∫≠t h·∫°ng m·ª•c ƒëang ƒë∆∞·ª£c ch·ªçn ƒë·ªÉ s·ª≠a."><span class="btn-spinner" style="display: none;"></span><svg class="icon-svg icon-inline" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg><span>Th√™m Item</span></button>
                    <button id="quickSaveToCatalogButtonForm" class="small-btn" title="L∆∞u nhanh th√¥ng tin c∆° b·∫£n c·ªßa h·∫°ng m·ª•c n√†y (T√™n, Quy c√°ch, ƒêVT, ƒê∆°n gi√°) v√†o Danh m·ª•c ch√≠nh ƒë·ªÉ t√°i s·ª≠ d·ª•ng sau n√†y.">L∆∞u nhanh v√†o DM</button>
                    <button id="cancelEditQuoteItemButtonForm" class="small-btn clear-btn" style="display:none;" title="H·ªßy b·ªè vi·ªác s·ª≠a h·∫°ng m·ª•c v√† x√≥a c√°c thay ƒë·ªïi trong form.">H·ªßy S·ª≠a</button>
                    <p class="item-line-total-preview-form">Th√†nh ti·ªÅn H·∫°ng m·ª•c: <strong id="itemLineTotalPreviewForm">0 VNƒê</strong></p>
                </div>
            </section>
            
            <hr class="no-print section-divider-accent">
            <section class="quote-preview-section">
                <h2>Chi ti·∫øt c√°c H·∫°ng m·ª•c trong B√°o gi√°</h2>
                <button id="prepareNewQuoteItemButton" class="add-new-row-btn small-btn no-print" style="margin-bottom: 15px;" title="Th√™m m·ªôt h·∫°ng m·ª•c tr·ªëng m·ªõi v√†o b√°o gi√°.">
                    <svg class="icon-svg icon-inline" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8z"/><path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v13a.5.5 0 0 1-1 0v-13A.5.5 0 0 1 8 1z"/></svg>
                    Th√™m d√≤ng m·ªõi
                </button>
                <div class="styled-table-container">
                    <table class="styled-table" id="quoteTablePreview">
                        <thead>
                            <tr>
                                <th style="width:3%;">STT</th>
                                <th style="width:8%;">·∫¢nh</th>
                                <th style="width:28%;">H·∫°ng M·ª•c / M√¥ T·∫£</th> 
                                <th style="width:5%;">ƒêVT</th>
                                <th style="width:6%;">K.L∆∞·ª£ng</th>
                                <th style="width:4%;">SL</th> 
                                <th style="width:10%;">ƒê∆°n gi√°</th>
                                <th style="width:12%;">Th√†nh ti·ªÅn</th>
                                <th style="width:24%;">Ghi Ch√∫</th>
                                <th class="no-print" style="width:4%;"></th>
                            </tr>
                        </thead>
                        <tbody id="itemListPreview">
                            <!-- Items will be rendered here by JS -->
                        </tbody>
                    </table>
                </div>
                <div class="total-section-minimal">
                    <strong>T·ªïng c·ªông: <span id="totalPriceMinimalBottom">0 VNƒê</span></strong>
                </div>
            </section>

            <section class="total-section">
                <div class="item-grid">
                    <div style="grid-column: span 2;">
                        <div class="form-group-inline">
                            <label for="subTotal">T·∫°m t√≠nh:</label>
                            <span id="subTotal" class="total-value-display">0 VNƒê</span>
                        </div>
                        <div class="form-group-inline">
                            <input type="checkbox" id="applyDiscountCheckbox" checked title="√Åp d·ª•ng gi·∫£m gi√° tr√™n t·ªïng h√≥a ƒë∆°n.">
                            <label for="applyDiscountCheckbox">Gi·∫£m gi√° t·ªïng:</label>
                            <div class="input-group">
                                <input type="number" id="discountValueInput" value="0" min="0" title="Nh·∫≠p gi√° tr·ªã gi·∫£m gi√°. C√≥ th·ªÉ l√† % c·ªßa t·ªïng t·∫°m t√≠nh ho·∫∑c m·ªôt s·ªë ti·ªÅn c·ªë ƒë·ªãnh (VNƒê).">
                                <select id="discountTypeSelect" class="input-group-select" title="Ch·ªçn lo·∫°i gi·∫£m gi√°: theo ph·∫ßn trƒÉm (%) ho·∫∑c s·ªë ti·ªÅn c·ªë ƒë·ªãnh (VNƒê).">
                                    <option value="percent">%</option>
                                    <option value="amount">VNƒê</option>
                                </select>
                            </div>
                            <span id="discountAmount" class="total-value-display">(0 VNƒê)</span>
                        </div>
                        <div class="form-group-inline">
                             <input type="checkbox" id="applyTaxCheckbox" checked title="√Åp d·ª•ng thu·∫ø Gi√° tr·ªã gia tƒÉng (VAT) v√†o h√≥a ƒë∆°n.">
                            <label for="applyTaxCheckbox">Thu·∫ø VAT (%):</label>
                            <input type="number" id="taxPercent" value="0" min="0" title="Nh·∫≠p ph·∫ßn trƒÉm thu·∫ø VAT. M·∫∑c ƒë·ªãnh l√† 0%.">
                             <span id="taxAmount" class="total-value-display">(0 VNƒê)</span>
                        </div>
                         <hr>
                        <div class="form-group-inline grand-total">
                            <label for="totalPrice">T·ªîNG C·ªòNG:</label>
                            <span id="totalPrice" class="total-value-display">0 VNƒê</span>
                        </div>
                    </div>
                     <div style="border-left: 1px solid var(--border-color-soft); padding-left: 22px;">
                        <details id="profitAnalysisSection" class="profit-analysis-section" title="M·ªü ƒë·ªÉ xem ph√¢n t√≠ch l·ª£i nhu·∫≠n d·ª±a tr√™n Gi√° v·ªën t·ª´ c√°c Phi·∫øu T√≠nh Gi√° ƒë√£ l∆∞u.">
                            <summary class="profit-analysis-summary">
                                <h3>Ph√¢n T√≠ch L·ª£i Nhu·∫≠n</h3>
                                <svg class="summary-toggle-svg" viewBox="0 0 16 16"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>
                            </summary>
                             <div class="profit-analysis-content">
                                <p>Gi√° v·ªën h√†ng b√°n (COGS) ∆∞·ªõc t√≠nh: <strong id="estimatedTotalCogs">0 VNƒê</strong></p>
                                <p>L·ª£i nhu·∫≠n g·ªôp ∆∞·ªõc t√≠nh: <strong id="estimatedGrossProfit">0 VNƒê</strong></p>
                                <p>T·ª∑ su·∫•t l·ª£i nhu·∫≠n g·ªôp: <strong id="grossProfitMarginPercent">0.0 %</strong></p>
                                <small>∆Ø·ªõc t√≠nh d·ª±a tr√™n c√°c s·∫£n ph·∫©m c√≥ trong phi·∫øu T√≠nh Gi√° Th√†nh ƒë√£ l∆∞u.</small>
                            </div>
                        </details>
                    </div>
                </div>
            </section>
            
            <section class="installments-section no-print">
                <div class="form-group-inline" style="justify-content: flex-start; margin-bottom: 5px;">
                     <input type="checkbox" id="applyInstallmentsCheckbox" title="B·∫≠t/t·∫Øt m·ª•c hi·ªÉn th·ªã l·ªãch thanh to√°n theo c√°c ƒë·ª£t trong file PDF.">
                     <label for="applyInstallmentsCheckbox" class="section-sub-label">Hi·ªÉn th·ªã L·ªãch Thanh to√°n trong PDF</label>
                </div>
                 <div id="installmentsContainer" style="display:none;">
                     <div id="installments-list"></div>
                     <div class="installment-summary" id="installments-summary"></div>
                     <button id="add-installment-button" class="small-btn" style="margin-top:10px;">+ Th√™m ƒê·ª£t</button>
                 </div>
            </section>
             
            <footer class="quote-actions-footer no-print">
                <button id="saveCurrentQuoteButton" class="save-btn" title="L∆∞u b√°o gi√° hi·ªán t·∫°i v√†o danh s√°ch 'BG ƒê√£ L∆∞u' ƒë·ªÉ qu·∫£n l√Ω v√† theo d√µi sau n√†y."><svg class="icon-svg icon-inline" viewBox="0 0 16 16"><path d="M8.5 1.5A1.5 1.5 0 0 0 7 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7.5a1.5 1.5 0 0 0-1.5-1.5h-5zm-1 5.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/></svg>L∆∞u B√°o Gi√°</button>
                <button id="previewPdfButton" class="preview-btn" title="Xem tr∆∞·ªõc file PDF c·ªßa b√°o gi√° trong m·ªôt tab m·ªõi tr∆∞·ªõc khi l∆∞u ho·∫∑c g·ª≠i."><svg class="icon-svg icon-inline" viewBox="0 0 16 16"><path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/><path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/></svg>Xem PDF</button>
                <button id="exportPdfButton" class="pdf-btn" title="T·∫°o v√† t·∫£i v·ªÅ file PDF c·ªßa b√°o gi√° ƒë·ªÉ g·ª≠i cho kh√°ch h√†ng."><svg class="icon-svg icon-inline" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/></svg>T·∫£i PDF</button>
                <button id="saveQuoteAsTemplateButton" class="small-btn" title="L∆∞u to√†n b·ªô b·ªë c·ª•c v√† c√°c h·∫°ng m·ª•c c·ªßa b√°o gi√° n√†y th√†nh m·ªôt m·∫´u ƒë·ªÉ t√°i s·ª≠ d·ª•ng nhanh ch√≥ng.">L∆∞u l√†m M·∫´u</button>
                <button id="clearQuoteButton" class="clear-btn" title="X√≥a to√†n b·ªô th√¥ng tin tr√™n form ƒë·ªÉ b·∫Øt ƒë·∫ßu m·ªôt b√°o gi√° m·ªõi."><svg class="icon-svg icon-inline" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/></svg>L√†m m·ªõi</button>
            </footer>
        </main>

        <!-- Tab Gi√° Th√†nh -->
        <main id="tabCosting" class="tab-content" role="tabpanel" aria-labelledby="tabCostingButton">
            <section>
                 <h2>T√≠nh Gi√° Th√†nh S·∫£n Ph·∫©m</h2>
                <div class="item-grid">
                    <div class="form-group">
                        <label for="costingProductName">T√™n S·∫£n ph·∫©m/D·ª± √°n:</label>
                        <input type="text" id="costingProductName" placeholder="V√≠ d·ª•: T·ªß b·∫øp MDF An C∆∞·ªùng">
                        <input type="hidden" id="costingSheetId">
                    </div>
                    <div class="form-group">
                        <label for="costingQuantityProduced">S·ªë l∆∞·ª£ng s·∫£n xu·∫•t (ƒë·ªÉ t√≠nh gi√° ƒë∆°n v·ªã):</label>
                        <input type="number" id="costingQuantityProduced" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label for="createCostingFromTemplateSelect">T·∫°o Phi·∫øu GT t·ª´ M·∫´u:</label>
                        <select id="createCostingFromTemplateSelect">
                            <option value="">-- Ch·ªçn m·∫´u PGT --</option>
                        </select>
                    </div>
                </div>
                 <div class="item-grid">
                     <div class="form-group">
                        <label for="costingProductLength">D√†i SP (mm):</label>
                        <input type="number" id="costingProductLength" placeholder="D√†i t·ªïng th·ªÉ">
                    </div>
                     <div class="form-group">
                        <label for="costingProductWidth">R·ªông/S√¢u SP (mm):</label>
                        <input type="number" id="costingProductWidth" placeholder="R·ªông t·ªïng th·ªÉ">
                    </div>
                     <div class="form-group">
                        <label for="costingProductHeight">Cao SP (mm):</label>
                        <input type="number" id="costingProductHeight" placeholder="Cao t·ªïng th·ªÉ">
                    </div>
                 </div>
            </section>
            
            <hr class="section-divider">

            <!-- Chi ph√≠ V·∫≠t t∆∞ Tr·ª±c ti·∫øp -->
            <details id="costingMaterialFormDetails" class="collapsible-form-section" open>
                <summary class="costing-section-summary">
                    <h3>Chi ph√≠ V·∫≠t t∆∞ Tr·ª±c ti·∫øp</h3>
                    <svg class="summary-toggle-svg" viewBox="0 0 16 16"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>
                </summary>
                <div class="costing-section-content">
                    <div id="costingMaterialEntryForm" class="item-entry-form-box">
                        <input type="hidden" id="editingMaterialIdInput">
                        <div class="item-grid-col4">
                            <div class="form-group" style="position: relative;">
                                <label for="costingMaterialName">T√™n V·∫≠t t∆∞ (g√µ ƒë·ªÉ t√¨m trong TV):</label>
                                <input type="text" id="costingMaterialName" placeholder="V√°n MDF, S∆°n PU, ...">
                                <div id="costingMaterialNameSuggestionsContainer" class="suggestions-container"></div>
                            </div>
                            <div class="form-group">
                                <label for="costingMaterialSpec">Quy c√°ch VT:</label>
                                <input type="text" id="costingMaterialSpec" placeholder="17mm, lo·∫°i 1, ...">
                            </div>
                            <div class="form-group">
                                <label for="costingMaterialUnit">ƒêVT:</label>
                                <input type="text" id="costingMaterialUnit" placeholder="t·∫•m, kg, ...">
                            </div>
                            <div class="form-group">
                                <label for="costingMaterialDimensions">K√≠ch th∆∞·ªõc VT (n·∫øu c√≥):</label>
                                <input type="text" id="costingMaterialDimensions" placeholder="1220x2440mm">
                            </div>
                        </div>
                        <div class="item-grid-col4">
                            <div class="form-group">
                                <label for="costingMaterialLinkDim">Li√™n k·∫øt SL v·ªõi K.th∆∞·ªõc SP:</label>
                                <select id="costingMaterialLinkDim">
                                    <option value="NONE">Nh·∫≠p th·ªß c√¥ng</option>
                                    <option value="PRODUCT_L">Theo Chi·ªÅu d√†i SP</option>
                                    <option value="PRODUCT_W">Theo Chi·ªÅu r·ªông SP</option>
                                    <option value="PRODUCT_H">Theo Chi·ªÅu cao SP</option>
                                    <option value="PRODUCT_AREA_LW">Theo Di·ªán t√≠ch (DxR) SP</option>
                                    <option value="PRODUCT_AREA_LH">Theo Di·ªán t√≠ch (DxC) SP</option>
                                    <option value="PRODUCT_AREA_WH">Theo Di·ªán t√≠ch (RxC) SP</option>
                                    <option value="PRODUCT_PERIMETER_LW">Theo Chu vi (2(D+R)) SP</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label id="costingMaterialQuantityLabel" for="costingMaterialQuantity">S·ªë l∆∞·ª£ng V·∫≠t t∆∞:</label>
                                <input type="number" id="costingMaterialQuantity" value="1" min="0">
                            </div>
                            <div class="form-group">
                                <label for="costingMaterialPrice">ƒê∆°n gi√° V·∫≠t t∆∞ (VNƒê):</label>
                                <input type="number" id="costingMaterialPrice" placeholder="0" min="0">
                            </div>
                            <div class="form-group">
                                <label for="costingMaterialWaste">% Hao h·ª•t:</label>
                                <input type="number" id="costingMaterialWaste" value="0" min="0" max="100">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button id="addCostingMaterialButton" class="small-btn">+ V·∫≠t T∆∞</button>
                            <button id="saveMaterialToLibraryButton" class="small-btn quick-save-to-catalog-btn">L∆∞u v√†o TV V·∫≠t t∆∞</button>
                            <button id="cancelEditMaterialButton" class="small-btn clear-btn" style="display:none;">H·ªßy S·ª≠a</button>
                        </div>
                    </div>
                    <div class="styled-table-container">
                        <table class="styled-table">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>T√™n V·∫≠t t∆∞</th>
                                    <th>Quy c√°ch</th>
                                    <th>LK K.th∆∞·ªõc</th>
                                    <th>ƒêVT</th>
                                    <th style="text-align:right;">SL/H·ªá s·ªë</th>
                                    <th style="text-align:right;">ƒê∆°n gi√°</th>
                                    <th style="text-align:right;">Hao h·ª•t</th>
                                    <th style="text-align:right;">Th√†nh ti·ªÅn</th>
                                    <th class="no-print"></th>
                                </tr>
                            </thead>
                            <tbody id="costingMaterialsList"></tbody>
                        </table>
                    </div>
                    <div class="total-section-minimal">
                        <strong>T·ªïng Chi ph√≠ V·∫≠t t∆∞: <span id="totalDirectMaterialsCostSpan">0 VNƒê</span></strong>
                    </div>
                </div>
            </details>
            
            <hr class="section-divider">
            
            <!-- Chi ph√≠ Nh√¢n c√¥ng Tr·ª±c ti·∫øp -->
            <details id="costingLaborFormDetails" class="collapsible-form-section" open>
                <summary class="costing-section-summary">
                    <h3>Chi ph√≠ Nh√¢n c√¥ng Tr·ª±c ti·∫øp</h3>
                     <svg class="summary-toggle-svg" viewBox="0 0 16 16"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>
                </summary>
                 <div class="costing-section-content">
                    <div id="costingLaborEntryForm" class="item-entry-form-box">
                         <input type="hidden" id="editingLaborIdInput">
                        <div class="item-grid">
                            <div class="form-group">
                                <label for="costingLaborDescription">C√¥ng ƒëo·∫°n:</label>
                                <input type="text" id="costingLaborDescription" placeholder="C·∫Øt v√°n, L·∫Øp r√°p, S∆°n PU...">
                            </div>
                            <div class="form-group">
                                <label for="costingLaborHours">S·ªë gi·ªù:</label>
                                <input type="number" id="costingLaborHours" placeholder="0" min="0">
                            </div>
                            <div class="form-group">
                                <label for="costingLaborRate">ƒê∆°n gi√°/gi·ªù (VNƒê):</label>
                                <input type="number" id="costingLaborRate" placeholder="0" min="0">
                            </div>
                        </div>
                         <div class="form-actions">
                            <button id="addCostingLaborButton" class="small-btn">+ N.C√¥ng</button>
                             <button id="cancelEditLaborButton" class="small-btn clear-btn" style="display:none;">H·ªßy S·ª≠a</button>
                        </div>
                    </div>
                     <div class="styled-table-container">
                         <table class="styled-table">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>C√¥ng ƒëo·∫°n</th>
                                    <th style="text-align:right;">S·ªë gi·ªù</th>
                                    <th style="text-align:right;">ƒê∆°n gi√°/gi·ªù</th>
                                    <th style="text-align:right;">Th√†nh ti·ªÅn</th>
                                    <th class="no-print"></th>
                                </tr>
                            </thead>
                            <tbody id="costingLaborList"></tbody>
                        </table>
                    </div>
                    <div class="total-section-minimal">
                        <strong>T·ªïng Chi ph√≠ Nh√¢n c√¥ng: <span id="totalDirectLaborCostSpan">0 VNƒê</span></strong>
                    </div>
                </div>
            </details>
            
            <hr class="section-divider">

             <!-- Chi ph√≠ S·∫£n xu·∫•t Chung, Qu·∫£n l√Ω, B√°n h√†ng -->
            <details class="collapsible-form-section" open>
                <summary class="costing-section-summary">
                    <h3>Chi ph√≠ Chung & C√°c Chi ph√≠ Kh√°c</h3>
                     <svg class="summary-toggle-svg" viewBox="0 0 16 16"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>
                </summary>
                <div class="costing-section-content">
                    <div class="item-grid">
                        <div class="form-group">
                            <label for="costingOverheadTotal">T·ªïng CP S·∫£n xu·∫•t chung (VNƒê):</label>
                            <input type="number" id="costingOverheadTotal" placeholder="Ti·ªÅn ƒëi·ªán, thu√™ x∆∞·ªüng, kh·∫•u hao..." min="0">
                        </div>
                         <div class="form-group">
                            <label for="costingManagementCostTotal">T·ªïng CP Qu·∫£n l√Ω Doanh nghi·ªáp (VNƒê):</label>
                            <input type="number" id="costingManagementCostTotal" placeholder="L∆∞∆°ng qu·∫£n l√Ω, vƒÉn ph√≤ng ph·∫©m..." min="0">
                        </div>
                        <div class="form-group">
                            <label for="costingSalesMarketingCostTotal">T·ªïng CP B√°n h√†ng & Marketing (VNƒê):</label>
                            <input type="number" id="costingSalesMarketingCostTotal" placeholder="Qu·∫£ng c√°o, hoa h·ªìng..." min="0">
                        </div>
                    </div>
                </div>
            </details>

            <details id="costingOtherCostFormDetails" class="collapsible-form-section">
                <summary class="costing-section-summary">
                    <h3>Chi ti·∫øt c√°c Chi ph√≠ Kh√°c (V·∫≠n chuy·ªÉn, l·∫Øp ƒë·∫∑t...)</h3>
                     <svg class="summary-toggle-svg" viewBox="0 0 16 16"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>
                </summary>
                 <div class="costing-section-content">
                    <div id="costingOtherCostEntryForm" class="item-entry-form-box">
                         <input type="hidden" id="editingOtherCostIdInput">
                        <div class="item-grid-col4" style="grid-template-columns: 2fr 1fr;">
                            <div class="form-group">
                                <label for="costingOtherCostDescription">N·ªôi dung chi ph√≠:</label>
                                <input type="text" id="costingOtherCostDescription" placeholder="V·∫≠n chuy·ªÉn, l·∫Øp ƒë·∫∑t...">
                            </div>
                            <div class="form-group">
                                <label for="costingOtherCostAmount">S·ªë ti·ªÅn (VNƒê):</label>
                                <input type="number" id="costingOtherCostAmount" placeholder="0" min="0">
                            </div>
                        </div>
                         <div class="form-actions">
                            <button id="addCostingOtherCostButton" class="small-btn">+ Th√™m C.Ph√≠ Kh√°c</button>
                             <button id="cancelEditOtherCostButton" class="small-btn clear-btn" style="display:none;">H·ªßy S·ª≠a</button>
                        </div>
                    </div>
                     <div class="styled-table-container">
                         <table class="styled-table">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>N·ªôi dung</th>
                                    <th style="text-align:right;">S·ªë ti·ªÅn</th>
                                    <th class="no-print"></th>
                                </tr>
                            </thead>
                            <tbody id="costingOtherCostsList"></tbody>
                        </table>
                    </div>
                    <div class="total-section-minimal">
                        <strong>T·ªïng Chi ph√≠ Kh√°c: <span id="totalOtherCostsSpan">0 VNƒê</span></strong>
                    </div>
                </div>
            </details>
            
            <hr class="section-divider-accent">
            
            <!-- Ph·∫ßn K·∫øt qu·∫£ -->
            <section>
                 <h2>K·∫øt qu·∫£ Gi√° th√†nh</h2>
                 <div class="total-section" style="text-align:center;">
                     <h3 style="color: var(--text-secondary-color);">T·ªïng Gi√° V·ªën H√†ng B√°n (COGS)</h3>
                     <p style="font-size: 2em; font-weight: bold; color: var(--primary-color); margin: 5px 0;" id="totalCostSpan">0 VNƒê</p>
                     <hr style="width:50%; margin: 15px auto;">
                     <h3 style="color: var(--text-secondary-color);">Gi√° V·ªën Tr√™n M·ªôt ƒê∆°n V·ªã S·∫£n Ph·∫©m</h3>
                     <p style="font-size: 1.6em; font-weight: bold; color: var(--primary-color); margin: 5px 0;" id="unitCostSpan">0 VNƒê</p>
                 </div>
            </section>
            
            <section class="what-if-scenario-section">
                <h3>Ph√¢n t√≠ch K·ªãch b·∫£n "What-If"</h3>
                <p><em>Thay ƒë·ªïi % c√°c lo·∫°i chi ph√≠ ch√≠nh ƒë·ªÉ xem ·∫£nh h∆∞·ªüng l√™n gi√° v·ªën ƒë∆°n v·ªã.</em></p>
                <div class="item-grid-col4">
                    <div class="form-group">
                        <label for="whatIfMaterialChange">Thay ƒë·ªïi CP V·∫≠t t∆∞ (%):</label>
                        <input type="number" id="whatIfMaterialChange" value="0">
                    </div>
                     <div class="form-group">
                        <label for="whatIfLaborChange">Thay ƒë·ªïi CP Nh√¢n c√¥ng (%):</label>
                        <input type="number" id="whatIfLaborChange" value="0">
                    </div>
                     <div class="form-group">
                        <label for="whatIfOverheadChange">Thay ƒë·ªïi CP SX Chung (%):</label>
                        <input type="number" id="whatIfOverheadChange" value="0">
                    </div>
                    <div class="form-group">
                         <label for="whatIfManagementChange">Thay ƒë·ªïi CP Qu·∫£n l√Ω (%):</label>
                         <input type="number" id="whatIfManagementChange" value="0">
                    </div>
                    <div class="form-group">
                         <label for="whatIfSalesMarketingChange">Thay ƒë·ªïi CP B√°n h√†ng (%):</label>
                         <input type="number" id="whatIfSalesMarketingChange" value="0">
                    </div>
                </div>
                <div class="form-actions" style="justify-content: center;">
                    <button id="calculateWhatIfButton" class="preview-btn">Ph√¢n t√≠ch K·ªãch b·∫£n</button>
                </div>
                <div class="what-if-results" style="margin-top: 15px; text-align:center;">
                    <p>Gi√° v·ªën ƒë∆°n v·ªã theo k·ªãch b·∫£n: <strong id="whatIfUnitCostSpan">0 VNƒê</strong></p>
                    <p>Ch√™nh l·ªách so v·ªõi gi√° g·ªëc: <strong id="whatIfDifferenceSpan">0 VNƒê</strong></p>
                </div>
            </section>


            <footer class="quote-actions-footer">
                <button id="calculateCostingButton" class="primary-action-btn small-btn">T√≠nh L·∫°i T·ªïng</button>
                <button id="saveCostingButton" class="save-btn">L∆∞u Phi·∫øu Gi√° Th√†nh</button>
                <button id="saveCostingAsTemplateButton" class="small-btn">L∆∞u l√†m M·∫´u</button>
                <button id="clearCostingFormButton" class="clear-btn">L√†m m·ªõi Form</button>
            </footer>
        </main>

        <!-- Tab BG ƒê√£ L∆∞u -->
        <main id="tabSavedQuotes" class="tab-content" role="tabpanel" aria-labelledby="tabSavedQuotesButton">
            <section class="catalog-filter-section">
                <h2>Danh s√°ch B√°o gi√° ƒë√£ l∆∞u</h2>
                <div class="item-grid-col4">
                     <div class="form-group">
                        <label for="savedQuotesSearchInput">T√¨m ki·∫øm (theo ID, T√™n KH):</label>
                        <input type="text" id="savedQuotesSearchInput" placeholder="Nh·∫≠p t·ª´ kh√≥a...">
                    </div>
                     <div class="form-group">
                        <label for="savedQuotesStatusFilter">L·ªçc theo Tr·∫°ng th√°i:</label>
                        <select id="savedQuotesStatusFilter">
                            <option value="all">T·∫•t c·∫£</option>
                            <option value="draft">So·∫°n th·∫£o</option>
                            <option value="sent">ƒê√£ g·ª≠i</option>
                            <option value="accepted">ƒê√£ ch·∫•p nh·∫≠n</option>
                            <option value="rejected">ƒê√£ t·ª´ ch·ªëi</option>
                            <option value="expired">ƒê√£ h·∫øt h·∫°n</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="savedQuotesStartDateFilter">T·ª´ ng√†y:</label>
                        <input type="date" id="savedQuotesStartDateFilter">
                    </div>
                     <div class="form-group">
                        <label for="savedQuotesEndDateFilter">ƒê·∫øn ng√†y:</label>
                        <input type="date" id="savedQuotesEndDateFilter">
                    </div>
                     <div class="form-group">
                        <label for="savedQuotesMinTotalFilter">T·ªïng ti·ªÅn t·ªëi thi·ªÉu:</label>
                        <input type="number" id="savedQuotesMinTotalFilter" placeholder="0">
                    </div>
                     <div class="form-group">
                        <label for="savedQuotesMaxTotalFilter">T·ªïng ti·ªÅn t·ªëi ƒëa:</label>
                        <input type="number" id="savedQuotesMaxTotalFilter" placeholder="Kh√¥ng gi·ªõi h·∫°n">
                    </div>
                </div>
            </section>
            <section class="catalog-preview-section">
                <div class="styled-table-container" style="max-height: 600px;">
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th>ID / T√™n B√°o gi√°</th>
                                <th>T√™n Kh√°ch h√†ng</th>
                                <th>Ng√†y t·∫°o</th>
                                <th>T·ªïng ti·ªÅn</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th class="no-print">H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody id="savedQuotesList">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
                 <div class="form-actions" style="justify-content: flex-end;">
                     <button id="loadMoreQuotesButton" class="small-btn" style="display: none;">T·∫£i th√™m b√°o gi√° c≈©...</button>
                </div>
            </section>
        </main>
        
        <!-- Tab Qu·∫£n L√Ω Danh M·ª•c -->
        <main id="tabCatalog" class="tab-content" role="tabpanel" aria-labelledby="tabCatalogButton">
            <div class="item-grid">
                <!-- Left Column for Management Forms -->
                <div class="catalog-management-forms">
                     <!-- Main Category Management -->
                    <section class="admin-section-box">
                        <h4>Qu·∫£n l√Ω Danh m·ª•c ch√≠nh (<span><strong id="mainCategoryCount">0</strong></span>)</h4>
                         <div class="item-grid" style="grid-template-columns: 2fr 1fr;">
                            <div class="form-group" style="margin-bottom: 5px;">
                                <input type="text" id="mainCategoryNameInput" placeholder="T√™n Danh m·ª•c ch√≠nh...">
                                <input type="hidden" id="editingMainCategoryId">
                            </div>
                            <div class="form-actions" style="margin-top: 0; justify-content: flex-start;">
                                <button id="addOrUpdateMainCategoryButton" class="small-btn save-btn">L∆∞u DM Ch√≠nh</button>
                                <button id="cancelEditMainCategoryButton" class="small-btn clear-btn" style="display:none;">H·ªßy</button>
                            </div>
                        </div>
                        <div class="table-container-scrollable" style="max-height: 180px;">
                            <table class="styled-table">
                                <thead>
                                    <tr>
                                        <th style="width: 15%;">STT</th>
                                        <th style="width: 65%;">T√™n Danh m·ª•c ch√≠nh</th>
                                        <th class="no-print" style="width: 20%;">H√†nh ƒë·ªông</th>
                                    </tr>
                                </thead>
                                <tbody id="mainCategoriesList"></tbody>
                            </table>
                        </div>
                    </section>
                    
                    <!-- Item Entry/Edit Form -->
                    <section class="admin-section-box">
                        <h4>Th√™m/S·ª≠a H·∫°ng m·ª•c trong Danh m·ª•c</h4>
                        <input type="hidden" id="editingCatalogEntryId">
                        <div class="form-group">
                            <label for="catalogEditMainCategorySelect">Danh m·ª•c ch√≠nh:</label>
                            <select id="catalogEditMainCategorySelect"></select>
                        </div>
                        <div class="form-group">
                            <label for="catalogEditName">T√™n H·∫°ng m·ª•c:</label>
                            <input type="text" id="catalogEditName" placeholder="T√™n s·∫£n ph·∫©m/d·ªãch v·ª•">
                        </div>
                        <div class="form-group">
                            <label for="catalogEditSpec">Quy c√°ch/M√¥ t·∫£:</label>
                            <textarea id="catalogEditSpec" rows="2" placeholder="Th√¥ng s·ªë k·ªπ thu·∫≠t..."></textarea>
                        </div>
                         <div class="item-grid" style="grid-template-columns: 1fr 1fr;">
                             <div class="form-group">
                                <label for="catalogEditUnit">ƒê∆°n v·ªã t√≠nh:</label>
                                <input type="text" id="catalogEditUnit" placeholder="m¬≤, c√°i, b·ªô...">
                            </div>
                            <div class="form-group">
                                <label for="catalogEditPrice">ƒê∆°n gi√°:</label>
                                <input type="number" id="catalogEditPrice" placeholder="0">
                            </div>
                        </div>
                        <div class="form-actions" style="justify-content: flex-start;">
                            <button id="saveCatalogEntryButton" class="save-btn">L∆∞u v√†o DM</button>
                            <button id="cancelCatalogEntryEditButton" class="clear-btn" style="display:none;">H·ªßy</button>
                        </div>
                    </section>

                    <!-- Import/Export Section -->
                    <section class="catalog-import-section admin-section-box">
                        <h4>Nh·∫≠p/Xu·∫•t Danh m·ª•c</h4>
                         <div class="form-group">
                            <label for="excelFileManage">Nh·∫≠p t·ª´ file Excel (.xlsx):</label>
                            <input type="file" id="excelFileManage" class="file-input" accept=".xlsx, .xls">
                            <button id="reloadExcelButton" class="small-btn reload-excel-btn" style="margin-top: 8px;">T·∫£i l·∫°i File</button>
                        </div>
                        <button id="exportCatalogButton" class="pdf-btn small-btn">Xu·∫•t DM ra Excel</button>
                    </section>
                </div>
                
                <!-- Right Column for Preview -->
                <div class="catalog-preview-section">
                    <h3>Xem tr∆∞·ªõc Danh m·ª•c (<span><strong id="catalogItemCount">0</strong></span>)</h3>
                    <div class="item-grid-col4">
                        <div class="form-group" style="grid-column: span 2;">
                            <label for="catalogSearchInput">T√¨m ki·∫øm (T√™n, Quy c√°ch):</label>
                            <input type="text" id="catalogSearchInput" placeholder="Nh·∫≠p ƒë·ªÉ t√¨m ki·∫øm...">
                        </div>
                        <div class="form-group">
                            <label for="catalogFilterMainCategorySelect">L·ªçc theo DM ch√≠nh:</label>
                            <select id="catalogFilterMainCategorySelect"></select>
                        </div>
                        <div class="form-group">
                            <label for="catalogSortSelect">S·∫Øp x·∫øp:</label>
                            <select id="catalogSortSelect">
                                <option value="name_asc">T√™n A-Z</option>
                                <option value="name_desc">T√™n Z-A</option>
                                <option value="price_asc">Gi√° tƒÉng d·∫ßn</option>
                                <option value="price_desc">Gi√° gi·∫£m d·∫ßn</option>
                            </select>
                        </div>
                        <div class="form-group">
                             <label for="catalogMinPriceFilter">Gi√° t·ªëi thi·ªÉu:</label>
                             <input type="number" id="catalogMinPriceFilter" placeholder="0">
                        </div>
                         <div class="form-group">
                             <label for="catalogMaxPriceFilter">Gi√° t·ªëi ƒëa:</label>
                             <input type="number" id="catalogMaxPriceFilter" placeholder="Kh√¥ng gi·ªõi h·∫°n">
                        </div>
                    </div>
                    
                    <div class="styled-table-container" style="max-height: 620px;" id="catalogPreviewTable">
                        <table class="styled-table">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>T√™n H·∫°ng m·ª•c</th>
                                    <th>Quy c√°ch</th>
                                    <th>ƒêVT</th>
                                    <th>ƒê∆°n gi√°</th>
                                    <th class="no-print">H√†nh ƒë·ªông</th>
                                </tr>
                            </thead>
                            <tbody id="catalogPreviewList"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Tab Qu·∫£n l√Ω M·∫´u -->
        <main id="tabTemplateManagement" class="tab-content" role="tabpanel" aria-labelledby="tabTemplateManagementButton">
            <div class="item-grid">
                <section class="template-section">
                    <h3>Qu·∫£n l√Ω M·∫´u B√°o gi√° (<span id="quoteTemplateCountSpan">0</span>)</h3>
                     <div class="styled-table-container">
                        <table class="styled-table">
                            <thead>
                                <tr>
                                    <th style="width: 10%;">STT</th>
                                    <th style="width: 50%;">T√™n M·∫´u</th>
                                    <th style="width: 15%; text-align:right;">S·ªë H.M·ª•c</th>
                                    <th style="width: 15%; text-align:center;">Ng√†y t·∫°o</th>
                                    <th class="no-print" style="width: 10%;"></th>
                                </tr>
                            </thead>
                            <tbody id="quoteTemplatesTableBody"></tbody>
                        </table>
                    </div>
                </section>
                <section class="template-section">
                    <h3>Qu·∫£n l√Ω M·∫´u Phi·∫øu T√≠nh Gi√° (<span id="costingTemplateCountSpan">0</span>)</h3>
                    <div class="styled-table-container">
                        <table class="styled-table">
                             <thead>
                                <tr>
                                    <th style="width: 10%;">STT</th>
                                    <th style="width: 50%;">T√™n M·∫´u</th>
                                    <th style="width: 15%; text-align:right;">S·ªë V·∫≠t t∆∞</th>
                                    <th style="width: 15%; text-align:center;">Ng√†y t·∫°o</th>
                                    <th class="no-print" style="width: 10%;"></th>
                                </tr>
                            </thead>
                            <tbody id="costingTemplatesTableBody"></tbody>
                        </table>
                    </div>
                </section>
            </div>
             <hr class="section-divider-accent">
             <section id="savedCostingSheetsSection" class="template-section">
                <h3>Phi·∫øu T√≠nh Gi√° ƒë√£ l∆∞u (<span id="savedCostingsCountSpan">0</span>)</h3>
                <div class="item-grid" style="grid-template-columns: 2fr 1fr;">
                     <div class="form-group">
                        <label for="savedCostingsSearchInput">T√¨m ki·∫øm Phi·∫øu T√≠nh Gi√°:</label>
                        <input type="text" id="savedCostingsSearchInput" placeholder="T√¨m theo t√™n s·∫£n ph·∫©m...">
                    </div>
                </div>
                <div class="styled-table-container" id="savedCostingsTable">
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th style="width: 5%;">STT</th>
                                <th style="width: 45%;">T√™n S·∫£n ph·∫©m</th>
                                <th style="width: 20%; text-align:center;">Ng√†y t·∫°o</th>
                                <th style="width: 20%; text-align:right;">Gi√° v·ªën ƒêV</th>
                                <th class="no-print" style="width: 10%;"></th>
                            </tr>
                        </thead>
                        <tbody id="savedCostingsList"></tbody>
                    </table>
                </div>
            </section>
            <hr class="section-divider-accent">
             <section id="materialsLibrarySection" class="template-section">
                <h3>Th∆∞ vi·ªán V·∫≠t t∆∞ (<span id="materialsLibraryCountSpan">0</span>)</h3>
                <div class="item-grid" style="grid-template-columns: 2fr 1fr;">
                     <div class="form-group">
                        <label for="materialsLibrarySearchInput">T√¨m ki·∫øm V·∫≠t t∆∞:</label>
                        <input type="text" id="materialsLibrarySearchInput" placeholder="T√¨m theo t√™n, quy c√°ch...">
                    </div>
                </div>
                <div class="styled-table-container" id="materialsLibraryTable">
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>T√™n V·∫≠t t∆∞</th>
                                <th>Quy c√°ch</th>
                                <th>ƒêVT</th>
                                <th style="text-align:right;">ƒê∆°n gi√°</th>
                                <th>K√≠ch th∆∞·ªõc</th>
                                <th class="no-print"></th>
                            </tr>
                        </thead>
                        <tbody id="materialsLibraryList"></tbody>
                    </table>
                </div>
             </section>
        </main>

        <!-- Tab C√†i ƒë·∫∑t -->
        <main id="tabSettings" class="tab-content" role="tabpanel" aria-labelledby="tabSettingsButton">
            <h2>C√†i ƒë·∫∑t</h2>
            <div class="item-grid">
                <!-- Company Info -->
                <div class="company-info-settings">
                    <section class="setting-group-box">
                        <span class="setting-group-label">Th√¥ng tin C√¥ng ty/C√° nh√¢n (hi·ªÉn th·ªã tr√™n PDF)</span>
                        <div class="form-group">
                            <label for="companyNameSetting">T√™n C√¥ng ty/C√° nh√¢n:</label>
                            <input type="text" id="companyNameSetting" placeholder="C√¥ng ty TNHH ABC">
                        </div>
                        <div class="form-group">
                            <label for="companyAddressSetting">ƒê·ªãa ch·ªâ:</label>
                            <input type="text" id="companyAddressSetting" placeholder="123 ƒê∆∞·ªùng XYZ, TP. PRTC">
                        </div>
                        <div class="form-group">
                            <label for="companyPhoneSetting">S·ªë ƒëi·ªán tho·∫°i:</label>
                            <input type="text" id="companyPhoneSetting" placeholder="09xxxxxxxx">
                        </div>
                        <div class="form-group">
                            <label for="companyEmailSetting">Email:</label>
                            <input type="text" id="companyEmailSetting" placeholder="email@example.com">
                        </div>
                        <div class="form-group">
                            <label for="companyTaxIdSetting">M√£ s·ªë thu·∫ø:</label>
                            <input type="text" id="companyTaxIdSetting" placeholder="N·∫øu c√≥">
                        </div>
                        <div class="form-group">
                             <label for="companyLogoFile">Logo C√¥ng ty (t·ªëi ƒëa 1MB, s·∫Ω hi·ªÉn th·ªã tr√™n PDF):</label>
                             <input type="file" id="companyLogoFile" accept="image/png, image/jpeg" class="file-input">
                             <img id="logoPreview" src="#" alt="Xem tr∆∞·ªõc logo" class="image-preview" style="background-color: #ccc;">
                        </div>
                    </section>
                </div>

                <!-- PDF & Other Settings -->
                <div>
                     <section class="setting-group-box">
                        <span class="setting-group-label">Th√¥ng tin t√†i kho·∫£n</span>
                        <div id="account-info-container" style="display: none;" class="account-details-box">
                           <div id="account-info-details">
                               <p>ƒêang t·∫£i...</p>
                           </div>
                        </div>
                     </section>
                    <section class="setting-group-box">
                        <span class="setting-group-label">T√πy ch·ªânh n·ªôi dung PDF</span>
                         <div class="form-group">
                            <label for="printTitleSetting">Ti√™u ƒë·ªÅ ch√≠nh:</label>
                            <input type="text" id="printTitleSetting" value="B√ÅO GI√Å">
                        </div>
                         <div class="form-group">
                            <label for="printCreatorNameSetting">T√™n Ng∆∞·ªùi l·∫≠p b√°o gi√°:</label>
                            <input type="text" id="printCreatorNameSetting" placeholder="T√™n c·ªßa b·∫°n">
                        </div>
                         <div class="form-group">
                             <label for="companyBankAccountSetting">Th√¥ng tin chuy·ªÉn kho·∫£n:</label>
                             <textarea id="companyBankAccountSetting" rows="3" placeholder="S·ªë TK: ...&#10;Ng√¢n h√†ng: ...&#10;Ch·ªß TK: ..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="defaultNotesSetting">Ghi ch√∫ & ƒêi·ªÅu kho·∫£n m·∫∑c ƒë·ªãnh:</label>
                            <textarea id="defaultNotesSetting" rows="4" placeholder="B√°o gi√° c√≥ hi·ªáu l·ª±c trong v√≤ng..."></textarea>
                        </div>
                        <div class="form-group">
                             <label for="printFooterSetting">N·ªôi dung ch√¢n trang (Footer):</label>
                             <textarea id="printFooterSetting" rows="2" placeholder="C·∫£m ∆°n s·ª± h·ª£p t√°c c·ªßa Qu√Ω kh√°ch!"></textarea>
                        </div>
                    </section>
                </div>
            </div>
             <footer class="quote-actions-footer">
                <button id="saveCompanySettingsButton" class="save-btn" title="L∆∞u l·∫°i t·∫•t c·∫£ c√°c c√†i ƒë·∫∑t tr√™n trang n√†y.">
                    <svg class="icon-svg icon-inline" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/></svg>
                    L∆∞u C√†i ƒê·∫∑t
                </button>
            </footer>

            <hr class="section-divider-accent">
            
            <section class="setting-group-box">
                <span class="setting-group-label">Sao l∆∞u & Ph·ª•c h·ªìi D·ªØ li·ªáu</span>
                <p style="font-size: 0.9em; color: var(--text-secondary-color);">T·∫°o m·ªôt b·∫£n sao l∆∞u to√†n b·ªô d·ªØ li·ªáu c·ªßa b·∫°n (b√°o gi√°, danh m·ª•c, m·∫´u...) v√†o m·ªôt file JSON.</p>
                <button id="backupDataButton" class="small-btn">Sao l∆∞u To√†n b·ªô D·ªØ li·ªáu</button>
                <hr style="margin: 15px 0; border-top-style: dashed;">
                <p style="font-size: 0.9em; color: var(--text-secondary-color);">Kh√¥i ph·ª•c d·ªØ li·ªáu t·ª´ m·ªôt file sao l∆∞u. <strong style="color:var(--danger-color);">C·∫¢NH B√ÅO: Thao t√°c n√†y s·∫Ω X√ìA S·∫†CH to√†n b·ªô d·ªØ li·ªáu hi·ªán t·∫°i tr∆∞·ªõc khi kh√¥i ph·ª•c.</strong></p>
                <div class="form-group">
                    <label for="restoreDataFile">Ch·ªçn file sao l∆∞u (.json):</label>
                    <input type="file" id="restoreDataFile" accept=".json" class="file-input">
                </div>
                <button id="restoreDataButton" class="small-btn delete-btn" disabled>Kh√¥i ph·ª•c t·ª´ File</button>
                <p id="restoreDataStatus" class="status-message"></p>
            </section>
        </main>

        <!-- Tab Qu·∫£n Tr·ªã -->
        <main id="tabAdmin" class="tab-content" role="tabpanel" aria-labelledby="tabAdminButton">
            <h2>Trang Qu·∫£n tr·ªã vi√™n</h2>
            <div class="item-grid">
                <section class="admin-section-box">
                    <h4>T√¨m & Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</h4>
                    <div class="form-group">
                        <label for="admin-search-user-input">T√¨m theo Email ho·∫∑c User ID:</label>
                        <div class="input-group">
                             <input type="text" id="admin-search-user-input" placeholder="example@gmail.com ho·∫∑c Abc123...">
                             <button id="admin-fetch-user-button" class="input-group-button">T√¨m</button>
                        </div>
                    </div>

                    <div id="admin-user-details-container" style="display:none;">
                        <div id="admin-user-details" class="account-details-box">
                            <p>Th√¥ng tin ng∆∞·ªùi d√πng s·∫Ω hi·ªán ·ªü ƒë√¢y.</p>
                        </div>
                        <input type="hidden" id="admin-target-user-id">
                        
                        <div class="item-grid" style="margin-top:15px;">
                             <div class="form-group">
                                <label for="admin-days-to-extend">Gia h·∫°n th√™m (ng√†y):</label>
                                <div class="input-group">
                                    <input type="number" id="admin-days-to-extend" placeholder="V√≠ d·ª•: 30">
                                    <button id="admin-update-expiry-button" class="input-group-button save-btn">Gia h·∫°n</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="admin-user-status-select">C·∫≠p nh·∫≠t Tr·∫°ng th√°i:</label>
                                 <div class="input-group">
                                     <select id="admin-user-status-select">
                                        <option value="active_trial">D√πng th·ª≠ (Active Trial)</option>
                                        <option value="active_paid">ƒê√£ tr·∫£ ph√≠ (Active Paid)</option>
                                        <option value="suspended">T·∫°m kh√≥a (Suspended)</option>
                                        <option value="disabled">V√¥ hi·ªáu h√≥a (Disabled)</option>
                                    </select>
                                    <button id="admin-update-status-button" class="input-group-button warning-btn">C·∫≠p nh·∫≠t TT</button>
                                </div>
                            </div>
                        </div>
                        <p id="admin-update-status" class="status-message"></p>
                    </div>
                </section>
                
                <section class="admin-section-box">
                    <h4>C√†i ƒë·∫∑t To√†n c·ª•c</h4>
                     <div class="form-group">
                        <label for="admin-default-trial-days">S·ªë ng√†y d√πng th·ª≠ m·∫∑c ƒë·ªãnh cho t√†i kho·∫£n m·ªõi:</label>
                        <input type="number" id="admin-default-trial-days" value="7" min="1">
                    </div>
                    <button id="admin-save-global-settings-button" class="small-btn save-btn">L∆∞u C√†i ƒë·∫∑t To√†n c·ª•c</button>
                    <p id="admin-global-settings-status" class="status-message"></p>
                    
                    <hr class="section-divider">

                    <h4>Th·ªëng k√™ nhanh</h4>
                    <div id="admin-stats-display" class="account-details-box">
                        <p>T·ªïng s·ªë ng∆∞·ªùi d√πng: <strong id="stats-total-users">...</strong></p>
                        <p>ƒêang ho·∫°t ƒë·ªông: <strong id="stats-active-users">...</strong></p>
                        <p>H·∫øt h·∫°n / B·ªã kh√≥a: <strong id="stats-expired-locked-users">...</strong></p>
                        <p>Ng∆∞·ªùi d√πng m·ªõi (7 ng√†y qua): <strong id="stats-new-last-7-days">...</strong></p>
                    </div>
                     <button id="admin-refresh-stats-button" class="small-btn" style="margin-top:10px;">L√†m m·ªõi Th·ªëng k√™</button>
                </section>
            </div>
        </main>
    </div>
    
    <div id="loader" class="loader-overlay" style="display: none;">
        <div class="loader-spinner"></div>
    </div>
    <div id="notification-container"></div>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>