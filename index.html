<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√°o Gi√° & Gi√° Th√†nh Pro - Hi·ªán ƒê·∫°i</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">

    <link rel="stylesheet" href="style.css"> 
    
    <!-- C√ÅC TH∆Ø VI·ªÜN B√äN TH·ª® BA -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="app-body">
    <!-- Modal ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω -->
    <div id="auth-modal" class="auth-modal-overlay" style="display: none;">
        <div class="auth-modal-content">
            <div id="auth-forms-container">
                <!-- Form ƒêƒÉng nh·∫≠p -->
                <form id="login-form">
                    <h2>ƒêƒÉng Nh·∫≠p</h2>
                    <p>ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c c√¥ng vi·ªác c·ªßa b·∫°n.</p>
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" required title="Nh·∫≠p ƒë·ªãa ch·ªâ email ƒë√£ ƒëƒÉng k√Ω.">
                    </div>
                    <div class="form-group">
                        <label for="login-password">M·∫≠t kh·∫©u</label>
                        <div class="password-wrapper">
                            <input type="password" id="login-password" required title="Nh·∫≠p m·∫≠t kh·∫©u c·ªßa b·∫°n.">
                            <button type="button" id="toggle-login-password" class="password-toggle" aria-label="Hi·ªán m·∫≠t kh·∫©u">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <div class="form-group form-group-checkbox">
                        <input type="checkbox" id="remember-me" title="Ch·ªçn ƒë·ªÉ ghi nh·ªõ th√¥ng tin ƒëƒÉng nh·∫≠p cho l·∫ßn sau.">
                        <label for="remember-me">Ghi nh·ªõ ƒëƒÉng nh·∫≠p</label>
                    </div>
                    <p id="login-error" class="error-message"></p>
                    <button type="submit" title="Nh·∫•n ƒë·ªÉ ƒëƒÉng nh·∫≠p v√†o ·ª©ng d·ª•ng.">ƒêƒÉng Nh·∫≠p</button>
                    <p class="auth-switch">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" id="show-signup" title="Chuy·ªÉn sang form ƒëƒÉng k√Ω t√†i kho·∫£n m·ªõi.">ƒêƒÉng k√Ω ngay</a></p>
                    <p class="auth-switch" style="margin-top: 5px;"><a href="#" id="forgot-password-link" title="Y√™u c·∫ßu g·ª≠i email ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u n·∫øu b·∫°n qu√™n.">Qu√™n m·∫≠t kh·∫©u?</a></p>
                </form>

                <!-- Form ƒêƒÉng k√Ω -->
                <form id="signup-form" style="display: none;">
                    <h2>ƒêƒÉng K√Ω</h2>
                    <p>T·∫°o t√†i kho·∫£n ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu an to√†n.</p>
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" required title="Nh·∫≠p ƒë·ªãa ch·ªâ email b·∫°n mu·ªën d√πng ƒë·ªÉ ƒëƒÉng k√Ω.">
                    </div>
                    <div class="form-group">
                        <label for="signup-password">M·∫≠t kh·∫©u (√≠t nh·∫•t 6 k√Ω t·ª±)</label>
                        <input type="password" id="signup-password" required title="T·∫°o m·∫≠t kh·∫©u cho t√†i kho·∫£n, y√™u c·∫ßu t·ªëi thi·ªÉu 6 k√Ω t·ª±.">
                    </div>
                    <p id="signup-error" class="error-message"></p>
                    <button type="submit" title="Ho√†n t·∫•t vi·ªác ƒëƒÉng k√Ω t√†i kho·∫£n m·ªõi.">ƒêƒÉng K√Ω</button>
                    <p class="auth-switch">ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" id="show-login" title="Chuy·ªÉn v·ªÅ form ƒëƒÉng nh·∫≠p n·∫øu b·∫°n ƒë√£ c√≥ t√†i kho·∫£n.">ƒêƒÉng nh·∫≠p</a></p>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Th√¥ng b√°o H·∫øt h·∫°n -->
    <div id="expiration-modal" class="auth-modal-overlay" style="display: none;">
        <div class="auth-modal-content">
            <h2>T√†i Kho·∫£n ƒê√£ H·∫øt H·∫°n</h2>
            <p>R·∫•t ti·∫øc, t√†i kho·∫£n c·ªßa b·∫°n ƒë√£ h·∫øt h·∫°n s·ª≠ d·ª•ng. Vui l√≤ng li√™n h·ªá qu·∫£n tr·ªã vi√™n ƒë·ªÉ gia h·∫°n v√† ti·∫øp t·ª•c s·ª≠ d·ª•ng d·ªãch v·ª•.</p>
            <p>To√†n b·ªô d·ªØ li·ªáu c·ªßa b·∫°n v·∫´n ƒë∆∞·ª£c l∆∞u tr·ªØ an to√†n.</p>
            <button id="logout-expired-button" class="delete-btn" title="ƒêƒÉng xu·∫•t kh·ªèi t√†i kho·∫£n ƒë√£ h·∫øt h·∫°n.">ƒêƒÉng xu·∫•t</button>
        </div>
    </div>

    <!-- N·ªôi dung ch√≠nh c·ªßa ·ª©ng d·ª•ng -->
    
    <div id="app-container" class="container" style="display: none;">
        <header class="app-header">
            <h1>B√°o gi√° & Gi√° th√†nh Pro</h1>
            <div id="auth-container" class="no-print">
                <button id="globalDarkModeToggleButton" class="small-btn dark-mode-toggle-global" title="Chuy·ªÉn ch·∫ø ƒë·ªô t·ªëi">üåô</button>
                <div class="user-avatar">üë§</div>
                <div id="user-info">
                    <p id="auth-status">ƒêang k·∫øt n·ªëi...</p>
                    <button id="logoutButton" style="display:none;" class="delete-btn small-btn" title="ƒêƒÉng xu·∫•t kh·ªèi t√†i kho·∫£n hi·ªán t·∫°i.">ƒê.Xu·∫•t</button>
                </div>
            </div>
        </header>

        <nav class="tabs no-print">
            <button class="tab-button active" data-tab="tabQuote" title="So·∫°n th·∫£o v√† qu·∫£n l√Ω b√°o gi√° chi ti·∫øt cho kh√°ch h√†ng.">B√°o Gi√°</button>
            <button class="tab-button" data-tab="tabCosting" title="T√≠nh to√°n gi√° th√†nh s·∫£n ph·∫©m d·ª±a tr√™n chi ph√≠ v·∫≠t t∆∞, nh√¢n c√¥ng v√† c√°c chi ph√≠ kh√°c.">Gi√° Th√†nh</button>
            <button class="tab-button" data-tab="tabSavedQuotes" title="Xem l·∫°i, qu·∫£n l√Ω v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i c√°c b√°o gi√° ƒë√£ l∆∞u.">BG ƒê√£ L∆∞u</button>
            <button class="tab-button" data-tab="tabCatalog" title="Qu·∫£n l√Ω danh m·ª•c s·∫£n ph·∫©m/d·ªãch v·ª• v√† th∆∞ vi·ªán v·∫≠t t∆∞.">Qu·∫£n L√Ω DM</button>
            <button class="tab-button" data-tab="tabTemplateManagement" title="Qu·∫£n l√Ω c√°c m·∫´u b√°o gi√° v√† phi·∫øu t√≠nh gi√° th∆∞·ªùng d√πng.">Qu·∫£n L√Ω M·∫´u</button>
            <button class="tab-button" data-tab="tabSettings" title="C√†i ƒë·∫∑t th√¥ng tin c√¥ng ty, t√πy ch·ªânh hi·ªÉn th·ªã PDF v√† qu·∫£n l√Ω t√†i kho·∫£n.">C√†i ƒê·∫∑t</button>
            <button class="tab-button" data-tab="tabAdmin" id="admin-tab" style="display: none;" title="Khu v·ª±c qu·∫£n tr·ªã d√†nh cho Admin ƒë·ªÉ qu·∫£n l√Ω t√†i kho·∫£n ng∆∞·ªùi d√πng.">Qu·∫£n tr·ªã</button>
        </nav>
        
        <!-- Tab B√°o Gi√° -->
        <main id="tabQuote" class="tab-content active" role="tabpanel" aria-labelledby="tabQuoteButton">
            <section class="quote-general-info">
                <h2>Th√¥ng tin Chung B√°o gi√°</h2>
                <div class="form-group-inline" style="justify-content: flex-start; margin-bottom: 15px;">
                    <label for="createQuoteFromTemplateSelect" style="margin-right: 5px;">T·∫°o BG t·ª´ M·∫´u:</label>
                    <select id="createQuoteFromTemplateSelect" style="max-width: 300px;" title="Ch·ªçn m·ªôt m·∫´u b√°o gi√° ƒë√£ l∆∞u ƒë·ªÉ nhanh ch√≥ng t·∫°o b√°o gi√° m·ªõi.">
                        <option value="">-- Ch·ªçn m·∫´u b√°o gi√° --</option>
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
                <div class="item-grid">
                    <div class="form-group">
                        <label for="customerName">T√™n Kh√°ch h√†ng:</label>
                        <input type="text" id="customerName" title="Nh·∫≠p t√™n ƒë·∫ßy ƒë·ªß c·ªßa kh√°ch h√†ng ho·∫∑c c√¥ng ty.">
                    </div>
                    <div class="form-group">
                        <label for="customerAddress">ƒê·ªãa ch·ªâ:</label>
                        <input type="text" id="customerAddress" title="Nh·∫≠p ƒë·ªãa ch·ªâ li√™n h·ªá c·ªßa kh√°ch h√†ng.">
                    </div>
                    <div class="form-group">
                        <label for="quoteDate">Ng√†y b√°o gi√°:</label>
                        <input type="date" id="quoteDate" title="Ch·ªçn ng√†y l·∫≠p b√°o gi√°. M·∫∑c ƒë·ªãnh l√† ng√†y hi·ªán t·∫°i.">
                    </div>
                </div>
            </section>

            <hr class="no-print section-divider">
            <section id="quoteItemEntryForm" class="no-print item-entry-form-box">
                <h3>Th√™m/S·ª≠a chi ti·∫øt H·∫°ng m·ª•c B√°o gi√°:</h3>
                <input type="hidden" id="editingQuoteItemIdForm">

                <div class="form-section">
                    <h4>Th√¥ng tin C∆° b·∫£n & Danh m·ª•c</h4>
                    <div class="form-group">
                        <label for="quoteItemMainCategoryInput">Ch·ªçn ho·∫∑c nh·∫≠p Danh m·ª•c ch√≠nh:</label>
                        <input type="text" id="quoteItemMainCategoryInput" list="mainCategoryDataList" placeholder="Ch·ªçn ho·∫∑c g√µ ƒë·ªÉ t·∫°o DM ch√≠nh m·ªõi..." title="Ch·ªçn t·ª´ danh m·ª•c ch√≠nh hi·ªán c√≥ ho·∫∑c g√µ t√™n m·ªõi ƒë·ªÉ t·∫°o nhanh. Gi√∫p ph√¢n lo·∫°i h·∫°ng m·ª•c trong b√°o gi√°.">
                        <datalist id="mainCategoryDataList"></datalist>
                    </div>
                    <div class="form-group" style="position: relative;">
                        <label for="itemNameQuoteForm">T√™n H·∫°ng m·ª•c (g√µ ƒë·ªÉ t√¨m g·ª£i √Ω t·ª´ DM ho·∫∑c Phi·∫øu Gi√° Th√†nh):</label>
                        <input type="text" id="itemNameQuoteForm" placeholder="V√≠ d·ª•: S∆°n Nippon, T·ªß b·∫øp MDF" title="G√µ ƒë·ªÉ t√¨m t√™n h·∫°ng m·ª•c t·ª´ Danh m·ª•c ƒë√£ l∆∞u ho·∫∑c t·ª´ c√°c Phi·∫øu T√≠nh Gi√° ƒë√£ t·∫°o. Ch·ªçn m·ªôt g·ª£i √Ω s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn c√°c th√¥ng tin li√™n quan.">
                        <div id="itemNameSuggestionsContainer" class="suggestions-container"></div>
                    </div>
                    <div class="form-group">
                        <label for="itemSpecQuoteForm">Quy c√°ch/M√¥ t·∫£ chi ti·∫øt:</label>
                        <textarea id="itemSpecQuoteForm" rows="2" placeholder="V√≠ d·ª•: Lo·∫°i A, m√†u X, b√≥ng m·ªù..." title="M√¥ t·∫£ chi ti·∫øt c√°c th√¥ng s·ªë k·ªπ thu·∫≠t, v·∫≠t li·ªáu, m√†u s·∫Øc, ki·ªÉu d√°ng c·ªßa h·∫°ng m·ª•c."></textarea>
                    </div>
                </div>
                <hr class="form-section-divider-subtle">
                <div class="form-section">
                    <h4>Chi ti·∫øt ƒê∆°n gi√° & T√≠nh to√°n</h4>
                    <div class="item-grid">
                        <div class="form-group">
                            <label for="itemUnitQuoteForm">ƒê∆°n v·ªã t√≠nh:</label>
                            <input type="text" id="itemUnitQuoteForm" placeholder="V√≠ d·ª•: m¬≤, c√°i" title="ƒê∆°n v·ªã t√≠nh cho h·∫°ng m·ª•c n√†y (v√≠ d·ª•: m¬≤, c√°i, b·ªô, kg, md).">
                        </div>
                        <div class="form-group">
                            <label for="itemPriceQuoteForm">ƒê∆°n gi√° (VNƒê):</label>
                            <input type="number" id="itemPriceQuoteForm" placeholder="0" min="0" title="ƒê∆°n gi√° g·ªëc c·ªßa h·∫°ng m·ª•c theo ƒêVT (ch∆∞a bao g·ªìm gi·∫£m gi√° h·∫°ng m·ª•c).">
                        </div>
                         <div class="form-group">
                            <label for="itemDiscountValueForm">
                                Gi·∫£m gi√° h·∫°ng m·ª•c:
                                <span class="help-icon" title="Nh·∫≠p gi√° tr·ªã gi·∫£m gi√° cho h·∫°ng m·ª•c n√†y. C√≥ th·ªÉ l√† % c·ªßa ƒë∆°n gi√° ho·∫∑c m·ªôt s·ªë ti·ªÅn c·ªë ƒë·ªãnh (VNƒê). N·∫øu ƒë∆°n gi√° l√† 100.000, gi·∫£m 10% s·∫Ω th√†nh 90.000. Gi·∫£m 5.000 VNƒê s·∫Ω th√†nh 95.000."><svg class="icon-svg icon-help" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 15A7 7 0 108 1a7 7 0 000 14zm0 1A8 8 0 108 0a8 8 0 000 16z"/><path d="M5.255 5.786a.237.237 0 00.241.247h.825c.138 0 .248-.11.248-.247V5.3c0-.138-.11-.247-.248-.247h-.825a.237.237 0 00-.241.247v.486zm0 0v-.505c0-.67.55-1.214 1.223-1.214h.022c.673 0 1.223.545 1.223 1.214v.305c0 .114.075.21.176.234l.308.077c.333.083.588.37.588.713v.39c0 .417-.34.757-.757.757h-.653c-.367 0-.67-.27-.72-.625a.262.262 0 00-.26-.23H6.023c-.373 0-.675.29-.675.648v.3c0 .346.28.626.626.626h.93v1.36h-.16c-.39 0-.707.317-.707.707v.353c0 .39.317.707.707.707h.16V13h.825c.138 0 .248-.11.248-.247V11.85c0-.138-.11-.247-.248-.247h-.825v-1.15c0-.39-.316-.707-.707-.707H6.023c-.673 0-1.223-.545-1.223-1.214v-.3c0-.36.253-.665.587-.723l.244-.04zm1.969.57H6.023c-.14 0-.253.11-.253.25v.3c0 .138.112.25.253.25h1.201c.14 0 .253-.112.253-.25v-.3c0-.14-.113-.25-.253-.25z"/></svg></span>
                            </label>
                            <div class="input-group">
                                <input type="number" id="itemDiscountValueForm" value="0" min="0" title="Gi√° tr·ªã gi·∫£m gi√° cho ri√™ng h·∫°ng m·ª•c n√†y. C√≥ th·ªÉ l√† % ho·∫∑c s·ªë ti·ªÅn c·ªë ƒë·ªãnh.">
                                <select id="itemDiscountTypeForm" class="input-group-select" title="Ch·ªçn lo·∫°i gi·∫£m gi√° cho h·∫°ng m·ª•c: theo ph·∫ßn trƒÉm (%) c·ªßa ƒë∆°n gi√° ho·∫∑c m·ªôt s·ªë ti·ªÅn c·ªë ƒë·ªãnh (VNƒê).">
                                    <option value="percent">%</option>
                                    <option value="amount">VNƒê</option>
                                </select>
                            </div>
                        </div>
                         <div class="form-group">
                            <label for="itemCalcTypeQuoteForm">
                                C√°ch t√≠nh gi√°:
                                <span class="help-icon" title="Theo ƒê∆°n v·ªã: Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x S·ªë l∆∞·ª£ng. Theo Chi·ªÅu d√†i: Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x (D√†i/1000) x S·ªë l∆∞·ª£ng. ƒê∆°n gi√° t√≠nh theo m√©t. Theo Di·ªán t√≠ch: Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x (D√†i/1000) x (Cao/1000) x S·ªë l∆∞·ª£ng. ƒê∆°n gi√° t√≠nh theo m√©t vu√¥ng. Theo Th·ªÉ t√≠ch: Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x (D√†i/1000) x (Cao/1000) x (S√¢u/1000) x S·ªë l∆∞·ª£ng. ƒê∆°n gi√° t√≠nh theo m√©t kh·ªëi."><svg class="icon-svg icon-help" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 15A7 7 0 108 1a7 7 0 000 14zm0 1A8 8 0 108 0a8 8 0 000 16z"/><path d="M5.255 5.786a.237.237 0 00.241.247h.825c.138 0 .248-.11.248-.247V5.3c0-.138-.11-.247-.248-.247h-.825a.237.237 0 00-.241.247v.486zm0 0v-.505c0-.67.55-1.214 1.223-1.214h.022c.673 0 1.223.545 1.223 1.214v.305c0 .114.075.21.176.234l.308.077c.333.083.588.37.588.713v.39c0 .417-.34.757-.757.757h-.653c-.367 0-.67-.27-.72-.625a.262.262 0 00-.26-.23H6.023c-.373 0-.675.29-.675.648v.3c0 .346.28.626.626.626h.93v1.36h-.16c-.39 0-.707.317-.707.707v.353c0 .39.317.707.707.707h.16V13h.825c.138 0 .248-.11.248-.247V11.85c0-.138-.11-.247-.248-.247h-.825v-1.15c0-.39-.316-.707-.707-.707H6.023c-.673 0-1.223-.545-1.223-1.214v-.3c0-.36.253-.665.587-.723l.244-.04zm1.969.57H6.023c-.14 0-.253.11-.253.25v.3c0 .138.112.25.253.25h1.201c.14 0 .253-.112.253-.25v-.3c0-.14-.113-.25-.253-.25z"/></svg></span>
                            </label>
                            <select id="itemCalcTypeQuoteForm" title="Ch·ªçn c√°ch th·ª©c t√≠nh to√°n kh·ªëi l∆∞·ª£ng/th√†nh ti·ªÅn cho h·∫°ng m·ª•c n√†y.">
                                <option value="unit" title="Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x S·ªë l∆∞·ª£ng. Kh√¥ng s·ª≠ d·ª•ng k√≠ch th∆∞·ªõc ƒë·ªÉ t√≠nh kh·ªëi l∆∞·ª£ng.">Theo ƒê∆°n v·ªã (Gi√° x SL)</option>
                                <option value="length" title="Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x (D√†i/1000) x S·ªë l∆∞·ª£ng. ƒê∆°n gi√° t√≠nh theo m√©t.">Theo Chi·ªÅu d√†i (Gi√° x D√†i x SL)</option>
                                <option value="area" title="Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x (D√†i/1000) x (Cao/1000) x S·ªë l∆∞·ª£ng. ƒê∆°n gi√° t√≠nh theo m√©t vu√¥ng.">Theo Di·ªán t√≠ch (Gi√° x D√†i x Cao x SL)</option>
                                <option value="volume" title="Th√†nh ti·ªÅn = (ƒê∆°n gi√° - Gi·∫£m gi√° HM) x (D√†i/1000) x (Cao/1000) x (S√¢u/1000) x S·ªë l∆∞·ª£ng. ƒê∆°n gi√° t√≠nh theo m√©t kh·ªëi.">Theo Th·ªÉ t√≠ch (Gi√° x D√†i x Cao x S√¢u x SL)</option>
                            </select>
                        </div>
                    </div>
                
                    <div class="item-grid-col4 dimensions-group">
                         <div class="form-group dimension-input-group" id="groupItemLengthQuoteForm">
                            <label for="itemLengthQuoteForm">D√†i (mm):</label>
                            <input type="number" id="itemLengthQuoteForm" placeholder="N·∫øu c√≥" min="0" step="0.01" title="K√≠ch th∆∞·ªõc chi·ªÅu d√†i c·ªßa h·∫°ng m·ª•c, t√≠nh b·∫±ng milim√©t (mm). S·∫Ω ƒë∆∞·ª£c quy ƒë·ªïi sang m√©t khi t√≠nh kh·ªëi l∆∞·ª£ng n·∫øu c√°ch t√≠nh gi√° l√† theo Chi·ªÅu d√†i, Di·ªán t√≠ch ho·∫∑c Th·ªÉ t√≠ch.">
                        </div>
                        <div class="form-group dimension-input-group" id="groupItemHeightQuoteForm">
                            <label for="itemHeightQuoteForm">Cao (mm):</label> <input type="number" id="itemHeightQuoteForm" placeholder="N·∫øu c√≥" min="0" step="0.01" title="K√≠ch th∆∞·ªõc chi·ªÅu cao/r·ªông c·ªßa h·∫°ng m·ª•c, t√≠nh b·∫±ng milim√©t (mm). S·∫Ω ƒë∆∞·ª£c quy ƒë·ªïi sang m√©t khi t√≠nh kh·ªëi l∆∞·ª£ng n·∫øu c√°ch t√≠nh gi√° l√† theo Di·ªán t√≠ch ho·∫∑c Th·ªÉ t√≠ch.">
                        </div>
                        <div class="form-group dimension-input-group" id="groupItemDepthQuoteForm">
                            <label for="itemDepthQuoteForm">S√¢u (mm):</label> <input type="number" id="itemDepthQuoteForm" placeholder="N·∫øu c√≥" min="0" step="0.01" title="K√≠ch th∆∞·ªõc chi·ªÅu s√¢u/d√†y c·ªßa h·∫°ng m·ª•c, t√≠nh b·∫±ng milim√©t (mm). S·∫Ω ƒë∆∞·ª£c quy ƒë·ªïi sang m√©t khi t√≠nh kh·ªëi l∆∞·ª£ng n·∫øu c√°ch t√≠nh gi√° l√† theo Th·ªÉ t√≠ch.">
                        </div>
                         <div class="form-group">
                            <label for="itemQuantityQuoteForm">S·ªë l∆∞·ª£ng (b·ªô/c√°i):</label>
                            <input type="number" id="itemQuantityQuoteForm" value="1" min="0.01" step="0.01" title="S·ªë l∆∞·ª£ng c·ªßa h·∫°ng m·ª•c n√†y (v√≠ d·ª•: 2 b·ªô, 5 c√°i, 1.5 l√¥).">
                        </div>
                    </div>
                     <p class="item-line-total-preview-form">Th√†nh ti·ªÅn H.M·ª•c (∆Ø·ªõc t√≠nh): <strong id="itemLineTotalPreviewForm">0 VNƒê</strong></p>
                </div>
                <hr class="form-section-divider-subtle">
                <details class="form-section-collapsible" open>
                    <summary class="form-section-summary"><h4>H√¨nh ·∫£nh & Ghi ch√∫ <svg class="summary-toggle-svg" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z"/></svg></h4></summary>
                    <div class="form-section-content">
                        <div class="item-grid" style="grid-template-columns: 1fr 2fr; gap: 20px;">
                            <div class="form-group">
                                <label for="itemImageFileQuoteForm">H√¨nh ·∫£nh h·∫°ng m·ª•c (nh·ªè, <500KB):</label>
                                <input type="file" id="itemImageFileQuoteForm" accept="image/*" class="file-input" title="T·∫£i l√™n h√¨nh ·∫£nh minh h·ªça cho h·∫°ng m·ª•c (khuy·∫øn ngh·ªã k√≠ch th∆∞·ªõc nh·ªè, d∆∞·ªõi 500KB). H√¨nh ·∫£nh s·∫Ω hi·ªÉn th·ªã tr√™n b√°o gi√° PDF.">
                                <div style="display: flex; align-items: center; margin-top: 5px;">
                                    <img id="itemImagePreviewQuoteForm" src="#" alt="Item Image Preview" class="image-preview" style="margin-right: 10px;">
                                    <button type="button" id="removeItemImageButtonQuoteForm" class="clear-btn small-btn" style="display:none;" title="X√≥a h√¨nh ·∫£nh ƒë√£ ch·ªçn."><svg class="icon-svg icon-inline" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M5.5 5.5A.5.5 0 016 6v6a.5.5 0 01-1 0V6a.5.5 0 01.5-.5zm2.5 0a.5.5 0 01.5.5v6a.5.5 0 01-1 0V6a.5.5 0 01.5-.5zm3 .5a.5.5 0 00-1 0v6a.5.5 0 001 0V6z"/><path fill-rule="evenodd" d="M14.5 3a1 1 0 01-1 1H13v9a2 2 0 01-2 2H5a2 2 0 01-2-2V4h-.5a1 1 0 01-1-1V2a1 1 0 011-1H6a1 1 0 011-1h2a1 1 0 011 1h3.5a1 1 0 011 1v1zM4.118 4L4 4.059V13a1 1 0 001 1h6a1 1 0 001-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/></svg> X√≥a ·∫£nh</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="itemNotesQuoteForm">Ghi ch√∫ h·∫°ng m·ª•c:</label>
                                <textarea id="itemNotesQuoteForm" rows="3" placeholder="Ghi ch√∫ th√™m cho h·∫°ng m·ª•c n√†y (n·∫øu c√≥)..." title="C√°c ghi ch√∫, l∆∞u √Ω ƒë·∫∑c bi·ªát ho·∫∑c th√¥ng tin b·ªï sung cho h·∫°ng m·ª•c n√†y. S·∫Ω hi·ªÉn th·ªã tr√™n b√°o gi√° PDF."></textarea>
                            </div>
                        </div>
                    </div>
                </details>
                <div class="form-actions">
                    <button id="addOrUpdateItemButtonForm" class="primary-action-btn" title="Th√™m ho·∫∑c c·∫≠p nh·∫≠t h·∫°ng m·ª•c n√†y v√†o b·∫£ng chi ti·∫øt b√°o gi√°.">Th√™m Item</button>
                    <button id="quickSaveToCatalogButtonForm" class="quick-save-to-catalog-btn" title="L∆∞u nhanh th√¥ng tin c∆° b·∫£n c·ªßa h·∫°ng m·ª•c n√†y (T√™n, Quy c√°ch, ƒêVT, ƒê∆°n gi√°, DM Ch√≠nh) v√†o Danh m·ª•c ch√≠nh ƒë·ªÉ s·ª≠ d·ª•ng l·∫°i sau n√†y.">L∆∞u DM</button>
                    <button type="button" id="cancelEditQuoteItemButtonForm" class="clear-btn" style="display:none;" title="H·ªßy b·ªè c√°c thay ƒë·ªïi ƒëang s·ª≠a v√† tr·ªü v·ªÅ tr·∫°ng th√°i th√™m m·ªõi.">H·ªßy S·ª≠a</button>
                </div>
            </section>
            
            <hr class="section-divider">
            <section class="quote-details-preview">
                <h2>Chi ti·∫øt B√°o gi√° Hi·ªán t·∫°i</h2>
                <div class="table-responsive styled-table-container">
                    <table id="quoteTablePreview" class="styled-table">
                        <thead>
                            <tr>
                                <th style="width:3%;">STT</th>
                                <th style="width:8%;">H√¨nh ·∫£nh</th>
                                <th style="width:25%;">H·∫°ng M·ª•c / Danh M·ª•c Ch√≠nh</th> 
                                <th style="width:5%;">ƒêVT</th>
                                <th style="width:5%;">K.L∆∞·ª£ng</th>
                                <th style="width:3%;">SL</th> 
                                <th style="width:8%;">ƒê∆°n gi√°</th>
                                <th style="width:10%;">Th√†nh ti·ªÅn</th>
                                <th style="width:12%;">Ghi Ch√∫</th>
                                <th style="width: 3%;" class="no-print action-trigger-cell-header" title="H√†nh ƒë·ªông cho h·∫°ng m·ª•c">...</th> 
                            </tr>
                        </thead>
                        <tbody id="itemListPreview"></tbody>
                    </table>
                </div>
                <button id="prepareNewQuoteItemButton" class="add-new-row-btn no-print" style="margin-top:15px;" title="X√≥a tr·∫Øng form nh·∫≠p li·ªáu ph√≠a tr√™n ƒë·ªÉ chu·∫©n b·ªã nh·∫≠p m·ªôt h·∫°ng m·ª•c ho√†n to√†n m·ªõi.">+ H.M·ª•c M·ªõi</button>
            </section>
            
            <section class="total-section">
                <div class="form-group-inline">
                    <input type="checkbox" id="applyDiscountCheckbox" checked title="Ch·ªçn ƒë·ªÉ √°p d·ª•ng gi·∫£m gi√° t·ªïng cho to√†n b·ªô b√°o gi√°."><label for="applyDiscountCheckbox">Gi·∫£m gi√°:</label>
                    <input type="number" id="discountValueInput" value="0" min="0" title="Gi√° tr·ªã gi·∫£m gi√° t·ªïng. C√≥ th·ªÉ l√† % ho·∫∑c s·ªë ti·ªÅn c·ªë ƒë·ªãnh.">
                    <select id="discountTypeSelect" style="width: 80px; margin-left: 5px;" title="Ch·ªçn lo·∫°i gi·∫£m gi√° t·ªïng: theo ph·∫ßn trƒÉm (%) c·ªßa t·ªïng t·∫°m t√≠nh ho·∫∑c m·ªôt s·ªë ti·ªÅn c·ªë ƒë·ªãnh (VNƒê)."><option value="percent">%</option><option value="amount">VNƒê</option></select>
                    <span id="discountAmount" class="total-value-display">(0 VNƒê)</span>
                </div>
                <div class="form-group-inline">
                    <input type="checkbox" id="applyTaxCheckbox" checked title="Ch·ªçn ƒë·ªÉ √°p d·ª•ng thu·∫ø VAT cho b√°o gi√°."><label for="applyTaxCheckbox">Thu·∫ø VAT (%):</label>
                    <input type="number" id="taxPercent" value="0" min="0" title="Ph·∫ßn trƒÉm thu·∫ø VAT (v√≠ d·ª•: 8 ho·∫∑c 10). Thu·∫ø ƒë∆∞·ª£c t√≠nh tr√™n t·ªïng ti·ªÅn sau khi ƒë√£ tr·ª´ gi·∫£m gi√°.">
                    <span id="taxAmount" class="total-value-display">(0 VNƒê)</span>
                </div>
                 <div><label>T·∫°m t√≠nh:</label><span id="subTotal">0 VNƒê</span></div>
                <hr style="margin: 10px 0; border-color: var(--border-color-soft);">
                <div class="grand-total"><label>T·ªïng c·ªông:</label><span id="totalPrice">0 VNƒê</span></div>
            </section>

            <details class="profit-analysis-section no-print" open>
                <summary class="profit-analysis-summary">
                    <h3>Ph√¢n t√≠ch L·ª£i nhu·∫≠n (∆Ø·ªõc t√≠nh) <svg class="summary-toggle-svg" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z"/></svg></h3>
                </summary>
                <div class="profit-analysis-content">
                    <p>T·ªïng Gi√° v·ªën ∆Ø·ªõc t√≠nh: <strong id="estimatedTotalCogs">0 VNƒê</strong></p>
                    <p>L·ª£i nhu·∫≠n G·ªôp ∆Ø·ªõc t√≠nh: <strong id="estimatedGrossProfit">0 VNƒê</strong></p>
                    <p>T·ª∑ su·∫•t L·ª£i nhu·∫≠n G·ªôp: <strong id="grossProfitMarginPercent">0 %</strong></p>
                    <small><em>L∆∞u √Ω: Gi√° v·ªën ƒë∆∞·ª£c ∆∞·ªõc t√≠nh d·ª±a tr√™n c√°c Phi·∫øu Gi√° Th√†nh (PGT) tr√πng t√™n s·∫£n ph·∫©m. ƒê·ªô ch√≠nh x√°c ph·ª• thu·ªôc v√†o d·ªØ li·ªáu PGT c·ªßa b·∫°n.</em></small>
                </div>
            </details>
            
            <section class="installments-section no-print">
                <hr class="section-divider-accent" style="margin-top: 25px;">
                <div class="form-group-inline" style="justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center;">
                        <input type="checkbox" id="applyInstallmentsCheckbox" title="Ch·ªçn ƒë·ªÉ chia t·ªïng ti·ªÅn b√°o gi√° th√†nh nhi·ªÅu ƒë·ª£t thanh to√°n. C√°c ƒë·ª£t thanh to√°n s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã tr√™n PDF.">
                        <label for="applyInstallmentsCheckbox" class="section-sub-label">B·∫≠t L·ªãch thanh to√°n theo ƒë·ª£t</label>
                    </div>
                    <button id="add-installment-button" class="small-btn no-print" style="margin: 0;" title="Th√™m m·ªôt ƒë·ª£t thanh to√°n m·ªõi v√†o l·ªãch.">+ Th√™m ƒë·ª£t</button>
                </div>
                <div id="installmentsContainer" class="installments-container" style="display: none;">
                    <div class="installment-row-header">
                        <span>N·ªôi dung ƒë·ª£t</span>
                        <span>Gi√° tr·ªã</span>
                        <span>Lo·∫°i</span>
                        <span>Th√†nh ti·ªÅn (VNƒê)</span>
                        <span style="width: 40px;"></span> <!-- C·ªôt cho n√∫t x√≥a -->
                    </div>
                    <div id="installments-list"></div>
                    <div id="installments-summary" class="installment-summary"></div>
                </div>
            </section>
            
            <footer class="quote-actions-footer no-print">
                <button id="saveQuoteAsTemplateButton" class="small-btn" title="L∆∞u b√°o gi√° hi·ªán t·∫°i th√†nh m·ªôt m·∫´u ƒë·ªÉ t√°i s·ª≠ d·ª•ng.">L∆∞u M·∫´u BG</button>
                <button id="saveCurrentQuoteButton" class="save-btn" title="L∆∞u b√°o gi√° hi·ªán t·∫°i v√†o danh s√°ch BG ƒê√£ L∆∞u tr√™n ƒë√°m m√¢y. B·∫°n c√≥ th·ªÉ ch·ªçn ghi ƒë√® ho·∫∑c l∆∞u b·∫£n m·ªõi.">L∆∞u BG</button>
                <button id="previewPdfButton" class="preview-btn" title="Xem tr∆∞·ªõc b√°o gi√° d∆∞·ªõi d·∫°ng PDF trong m·ªôt tab m·ªõi c·ªßa tr√¨nh duy·ªát.">Xem PDF</button>
                <button id="exportPdfButton" class="pdf-btn" title="T·∫£i b√°o gi√° hi·ªán t·∫°i xu·ªëng m√°y d∆∞·ªõi d·∫°ng file PDF.">Xu·∫•t PDF</button>
                <button id="clearQuoteButton" class="clear-btn" title="X√≥a to√†n b·ªô n·ªôi dung b√°o gi√° hi·ªán t·∫°i ƒë·ªÉ b·∫Øt ƒë·∫ßu m·ªôt b√°o gi√° m·ªõi.">L√†m M·ªõi</button>
            </footer>
        </main>

        <!-- Tab Gi√° Th√†nh -->
        <main id="tabCosting" class="tab-content" role="tabpanel" aria-labelledby="tabCostingButton">
            <h2>T√≠nh to√°n Gi√° th√†nh S·∫£n ph·∫©m</h2>
            <div class="form-group-inline" style="justify-content: flex-start; margin-bottom: 15px;">
                <label for="createCostingFromTemplateSelect" style="margin-right: 5px;">T·∫°o PGT t·ª´ M·∫´u:</label>
                <select id="createCostingFromTemplateSelect" style="max-width: 300px;" title="Ch·ªçn m·ªôt m·∫´u phi·∫øu t√≠nh gi√° ƒë√£ l∆∞u ƒë·ªÉ nhanh ch√≥ng t·∫°o phi·∫øu m·ªõi.">
                    <option value="">-- Ch·ªçn m·∫´u PGT --</option>
                    <!-- Options will be populated by JS -->
                </select>
            </div>
            
            <!-- 1. Th√¥ng tin S·∫£n ph·∫©m M·ª•c ti√™u -->
            <section class="form-section">
                <h4>Th√¥ng tin S·∫£n ph·∫©m M·ª•c ti√™u</h4>
                <div class="form-group">
                    <label for="costingProductName">T√™n S·∫£n ph·∫©m:</label>
                    <input type="text" id="costingProductName" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m..." title="T√™n c·ªßa s·∫£n ph·∫©m ho·∫∑c h·∫°ng m·ª•c c·∫ßn t√≠nh gi√° th√†nh. C√≥ th·ªÉ ƒë∆∞·ª£c ƒëi·ªÅn t·ª± ƒë·ªông t·ª´ Tab B√°o Gi√°.">
                </div>
                 <input type="hidden" id="costingSheetId" placeholder="V√≠ d·ª•: SP001-COST" title="M√£ ƒë·ªãnh danh duy nh·∫•t cho phi·∫øu t√≠nh gi√° n√†y. N·∫øu ƒë·ªÉ tr·ªëng, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông t·∫°o m·ªôt ID khi l∆∞u.">
                <div class="item-grid" style="grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px;">
                    <!-- Removed hidden label and its container for costingSheetId -->
                    <div class="form-group">
                        <label for="costingProductLength">D√†i SP (mm):</label>
                        <input type="number" id="costingProductLength" placeholder="0" min="0" title="K√≠ch th∆∞·ªõc chi·ªÅu d√†i t·ªïng th·ªÉ c·ªßa s·∫£n ph·∫©m ho√†n thi·ªán (t√≠nh b·∫±ng mm). ƒê∆∞·ª£c d√πng ƒë·ªÉ li√™n k·∫øt s·ªë l∆∞·ª£ng v·∫≠t t∆∞ n·∫øu c·∫ßn.">
                    </div>
                    <div class="form-group">
                        <label for="costingProductWidth">R·ªông SP (mm):</label>
                        <input type="number" id="costingProductWidth" placeholder="0" min="0" title="K√≠ch th∆∞·ªõc chi·ªÅu r·ªông/s√¢u t·ªïng th·ªÉ c·ªßa s·∫£n ph·∫©m ho√†n thi·ªán (t√≠nh b·∫±ng mm). ƒê∆∞·ª£c d√πng ƒë·ªÉ li√™n k·∫øt s·ªë l∆∞·ª£ng v·∫≠t t∆∞ n·∫øu c·∫ßn.">
                    </div>
                    <div class="form-group">
                        <label for="costingProductHeight">Cao SP (mm):</label>
                        <input type="number" id="costingProductHeight" placeholder="0" min="0" title="K√≠ch th∆∞·ªõc chi·ªÅu cao t·ªïng th·ªÉ c·ªßa s·∫£n ph·∫©m ho√†n thi·ªán (t√≠nh b·∫±ng mm). ƒê∆∞·ª£c d√πng ƒë·ªÉ li√™n k·∫øt s·ªë l∆∞·ª£ng v·∫≠t t∆∞ n·∫øu c·∫ßn.">
                    </div>
                </div>
                <div class="form-group" style="max-width: 250px;">
                    <label for="costingQuantityProduced">S·ªë l∆∞·ª£ng S·∫£n xu·∫•t (ƒê∆°n v·ªã SP):</label>
                    <input type="number" id="costingQuantityProduced" placeholder="0" min="1" value="1" title="S·ªë l∆∞·ª£ng s·∫£n ph·∫©m d·ª± ki·∫øn s·∫£n xu·∫•t trong m·ªôt l√¥. Gi√° th√†nh ƒë∆°n v·ªã s·∫Ω ƒë∆∞·ª£c chia cho s·ªë l∆∞·ª£ng n√†y.">
                </div>
            </section>
            
            <hr class="section-divider">

            <!-- 2. Chi ph√≠ V·∫≠t t∆∞ Tr·ª±c ti·∫øp -->
            <section class="costing-materials-section">
                <details class="collapsible-form-section no-print" id="costingMaterialFormDetails" open>
                    <summary class="costing-section-summary" title="Nh·∫•n ƒë·ªÉ Hi·ªán/·∫®n form nh·∫≠p li·ªáu chi ti·∫øt v·∫≠t t∆∞.">
                        <h3>Chi ph√≠ V·∫≠t t∆∞ Tr·ª±c ti·∫øp <svg class="summary-toggle-svg" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z"/></svg></h3>
                    </summary>
                    <div id="costingMaterialEntryForm" class="item-entry-form-box" style="margin-top: 10px;">
                        <input type="hidden" id="editingMaterialIdInput">
                        <div class="item-grid" style="grid-template-columns: 1fr 1fr; gap:15px 20px; align-items: end;">
                            <div class="form-group" style="margin-bottom: 0; position: relative;">
                                <label for="costingMaterialName">T√™n V·∫≠t t∆∞ (g√µ ƒë·ªÉ t√¨m g·ª£i √Ω):</label>
                                <input type="text" id="costingMaterialName" placeholder="V√°n MDF, Mica FS, LED..." title="G√µ ƒë·ªÉ t√¨m t√™n v·∫≠t t∆∞ t·ª´ Th∆∞ vi·ªán v·∫≠t t∆∞ ƒë√£ l∆∞u ho·∫∑c t·ª´ c√°c Phi·∫øu T√≠nh Gi√° c≈©. Ch·ªçn g·ª£i √Ω ƒë·ªÉ t·ª± ƒëi·ªÅn th√¥ng tin.">
                                <div id="costingMaterialNameSuggestionsContainer" class="suggestions-container"></div>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="costingMaterialSpec">Quy c√°ch/M√£ hi·ªáu:</label>
                                <input type="text" id="costingMaterialSpec" placeholder="An C∆∞·ªùng 17mm, FS 3mm Trong..." title="Quy c√°ch, m√£ hi·ªáu, m√†u s·∫Øc, ho·∫∑c m√¥ t·∫£ chi ti·∫øt c·ªßa v·∫≠t t∆∞.">
                            </div>
                             <div class="form-group" style="margin-bottom: 0;">
                                <label for="costingMaterialLinkDim">
                                    Li√™n k·∫øt S·ªë l∆∞·ª£ng v·ªõi K.Th∆∞·ªõc SP?
                                    <span class="help-icon" title="Ch·ªçn c√°ch li√™n k·∫øt s·ªë l∆∞·ª£ng v·∫≠t t∆∞ s·ª≠ d·ª•ng v·ªõi k√≠ch th∆∞·ªõc c·ªßa s·∫£n ph·∫©m ho√†n thi·ªán. 'Kh√¥ng': Nh·∫≠p SL th·ªß c√¥ng. 'Theo Chi·ªÅu D√†i SP': SL V·∫≠t t∆∞ = (D√†i SP t√≠nh b·∫±ng m√©t) x (H·ªá s·ªë). V√† t∆∞∆°ng t·ª± cho c√°c l·ª±a ch·ªçn kh√°c."><svg class="icon-svg icon-help" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 15A7 7 0 108 1a7 7 0 000 14zm0 1A8 8 0 108 0a8 8 0 000 16z"/><path d="M5.255 5.786a.237.237 0 00.241.247h.825c.138 0 .248-.11.248-.247V5.3c0-.138-.11-.247-.248-.247h-.825a.237.237 0 00-.241.247v.486zm0 0v-.505c0-.67.55-1.214 1.223-1.214h.022c.673 0 1.223.545 1.223 1.214v.305c0 .114.075.21.176.234l.308.077c.333.083.588.37.588.713v.39c0 .417-.34.757-.757.757h-.653c-.367 0-.67-.27-.72-.625a.262.262 0 00-.26-.23H6.023c-.373 0-.675.29-.675.648v.3c0 .346.28.626.626.626h.93v1.36h-.16c-.39 0-.707.317-.707.707v.353c0 .39.317.707.707.707h.16V13h.825c.138 0 .248-.11.248-.247V11.85c0-.138-.11-.247-.248-.247h-.825v-1.15c0-.39-.316-.707-.707-.707H6.023c-.673 0-1.223-.545-1.223-1.214v-.3c0-.36.253-.665.587-.723l.244-.04zm1.969.57H6.023c-.14 0-.253.11-.253.25v.3c0 .138.112.25.253.25h1.201c.14 0 .253-.112.253-.25v-.3c0-.14-.113-.25-.253-.25z"/></svg></span>
                                </label>
                                <select id="costingMaterialLinkDim" title="Ch·ªçn c√°ch li√™n k·∫øt s·ªë l∆∞·ª£ng v·∫≠t t∆∞ s·ª≠ d·ª•ng v·ªõi k√≠ch th∆∞·ªõc c·ªßa s·∫£n ph·∫©m ho√†n thi·ªán.">
                                    <option value="NONE" title="Nh·∫≠p s·ªë l∆∞·ª£ng v·∫≠t t∆∞ th·ªß c√¥ng. V√≠ d·ª•: c·∫ßn 2 b·∫£n l·ªÅ.">Kh√¥ng (Nh·∫≠p SL th·ªß c√¥ng)</option>
                                    <option value="PRODUCT_L" title="S·ªë l∆∞·ª£ng V·∫≠t t∆∞ = (Chi·ªÅu D√†i S·∫£n Ph·∫©m t√≠nh b·∫±ng m√©t) x (H·ªá s·ªë b·∫°n nh·∫≠p). V√≠ d·ª•: n·∫πp theo chi·ªÅu d√†i s·∫£n ph·∫©m.">Theo Chi·ªÅu D√†i SP (xSLVT)</option>
                                    <option value="PRODUCT_W" title="S·ªë l∆∞·ª£ng V·∫≠t t∆∞ = (Chi·ªÅu R·ªông/S√¢u S·∫£n Ph·∫©m t√≠nh b·∫±ng m√©t) x (H·ªá s·ªë b·∫°n nh·∫≠p).">Theo Chi·ªÅu R·ªông SP (xSLVT)</option>
                                    <option value="PRODUCT_H" title="S·ªë l∆∞·ª£ng V·∫≠t t∆∞ = (Chi·ªÅu Cao S·∫£n Ph·∫©m t√≠nh b·∫±ng m√©t) x (H·ªá s·ªë b·∫°n nh·∫≠p).">Theo Chi·ªÅu Cao SP (xSLVT)</option>
                                    <option value="PRODUCT_AREA_LW" title="S·ªë l∆∞·ª£ng V·∫≠t t∆∞ = (Di·ªán t√≠ch D√†i x R·ªông S·∫£n Ph·∫©m t√≠nh b·∫±ng m√©t vu√¥ng) x (H·ªá s·ªë b·∫°n nh·∫≠p). V√≠ d·ª•: v√°n cho m·∫∑t b√†n.">Theo Di·ªán t√≠ch SP (D√†i x R·ªông) (xSLVT)</option>
                                    <option value="PRODUCT_AREA_LH" title="S·ªë l∆∞·ª£ng V·∫≠t t∆∞ = (Di·ªán t√≠ch D√†i x Cao S·∫£n Ph·∫©m t√≠nh b·∫±ng m√©t vu√¥ng) x (H·ªá s·ªë b·∫°n nh·∫≠p). V√≠ d·ª•: v√°n cho m·∫∑t ƒë·ª©ng.">Theo Di·ªán t√≠ch SP (D√†i x Cao) (xSLVT)</option>
                                    <option value="PRODUCT_AREA_WH" title="S·ªë l∆∞·ª£ng V·∫≠t t∆∞ = (Di·ªán t√≠ch R·ªông x Cao S·∫£n Ph·∫©m t√≠nh b·∫±ng m√©t vu√¥ng) x (H·ªá s·ªë b·∫°n nh·∫≠p). V√≠ d·ª•: v√°n cho m·∫∑t h√¥ng.">Theo Di·ªán t√≠ch SP (R·ªông x Cao) (xSLVT)</option>
                                    <option value="PRODUCT_PERIMETER_LW" title="S·ªë l∆∞·ª£ng V·∫≠t t∆∞ = (Chu vi m·∫∑t D√†i+R·ªông S·∫£n Ph·∫©m t√≠nh b·∫±ng m√©t) x (H·ªá s·ªë b·∫°n nh·∫≠p). V√≠ d·ª•: n·∫πp vi·ªÅn xung quanh.">Theo Chu vi m·∫∑t SP (2(D+R)) (xSLVT)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="costingMaterialQuantity" id="costingMaterialQuantityLabel">S·ªë l∆∞·ª£ng / H·ªá s·ªë nh√¢n:</label>
                                <input type="number" id="costingMaterialQuantity" placeholder="0" min="0" step="any" value="1" title="N·∫øu kh√¥ng li√™n k·∫øt k√≠ch th∆∞·ªõc: ƒë√¢y l√† s·ªë l∆∞·ª£ng v·∫≠t t∆∞ tr·ª±c ti·∫øp s·ª≠ d·ª•ng cho t·ªïng s·ªë l∆∞·ª£ng s·∫£n ph·∫©m s·∫£n xu·∫•t. N·∫øu c√≥ li√™n k·∫øt: ƒë√¢y l√† h·ªá s·ªë nh√¢n v·ªõi k√≠ch th∆∞·ªõc s·∫£n ph·∫©m ƒë√£ ch·ªçn ƒë·ªÉ ra s·ªë l∆∞·ª£ng v·∫≠t t∆∞.">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="costingMaterialUnit">ƒêVT (cho ƒë∆°n gi√°):</label>
                                <input type="text" id="costingMaterialUnit" placeholder="t·∫•m, m2, m√©t, c√°i" title="ƒê∆°n v·ªã t√≠nh c·ªßa v·∫≠t t∆∞, t∆∞∆°ng ·ª©ng v·ªõi ƒë∆°n gi√° nh·∫≠p (v√≠ d·ª•: t·∫•m, m2, kg, c√¢y, md).">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="costingMaterialDimensions">K√≠ch th∆∞·ªõc tham kh·∫£o VT (DxR mm):</label>
                                <input type="text" id="costingMaterialDimensions" placeholder="1220x2440 (n·∫øu c√≥)" title="K√≠ch th∆∞·ªõc tham kh·∫£o c·ªßa ch√≠nh v·∫≠t t∆∞ ƒë√≥ (v√≠ d·ª•: t·∫•m v√°n 1220x2440mm, cu·ªôn n·∫πp d√†i 50m). D√πng ƒë·ªÉ tham kh·∫£o, kh√¥ng tr·ª±c ti·∫øp d√πng trong t√≠nh to√°n t·ª± ƒë·ªông tr·ª´ khi b·∫°n t·ª± quy ƒë·ªïi.">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="costingMaterialPrice">ƒê∆°n gi√° (VNƒê / ƒêVT tr√™n):</label>
                                <input type="number" id="costingMaterialPrice" placeholder="0" min="0" title="ƒê∆°n gi√° c·ªßa v·∫≠t t∆∞ theo ƒê∆°n v·ªã t√≠nh ƒë√£ nh·∫≠p (v√≠ d·ª•: gi√° 1 t·∫•m v√°n, gi√° 1m2 mica).">
                            </div>
                             <div class="form-group" style="margin-bottom: 0;">
                                <label for="costingMaterialWaste">
                                    % Hao h·ª•t:
                                    <span class="help-icon" title="Ph·∫ßn trƒÉm v·∫≠t t∆∞ b·ªã hao h·ª•t trong qu√° tr√¨nh s·∫£n xu·∫•t (v√≠ d·ª•: c·∫Øt th·ª´a, l·ªói). Nh·∫≠p 10 cho 10%. Chi ph√≠ v·∫≠t t∆∞ s·∫Ω tƒÉng th√™m % n√†y."><svg class="icon-svg icon-help" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 15A7 7 0 108 1a7 7 0 000 14zm0 1A8 8 0 108 0a8 8 0 000 16z"/><path d="M5.255 5.786a.237.237 0 00.241.247h.825c.138 0 .248-.11.248-.247V5.3c0-.138-.11-.247-.248-.247h-.825a.237.237 0 00-.241.247v.486zm0 0v-.505c0-.67.55-1.214 1.223-1.214h.022c.673 0 1.223.545 1.223 1.214v.305c0 .114.075.21.176.234l.308.077c.333.083.588.37.588.713v.39c0 .417-.34.757-.757.757h-.653c-.367 0-.67-.27-.72-.625a.262.262 0 00-.26-.23H6.023c-.373 0-.675.29-.675.648v.3c0 .346.28.626.626.626h.93v1.36h-.16c-.39 0-.707.317-.707.707v.353c0 .39.317.707.707.707h.16V13h.825c.138 0 .248-.11.248-.247V11.85c0-.138-.11-.247-.248-.247h-.825v-1.15c0-.39-.316-.707-.707-.707H6.023c-.673 0-1.223-.545-1.223-1.214v-.3c0-.36.253-.665.587-.723l.244-.04zm1.969.57H6.023c-.14 0-.253.11-.253.25v.3c0 .138.112.25.253.25h1.201c.14 0 .253-.112.253-.25v-.3c0-.14-.113-.25-.253-.25z"/></svg></span>
                                </label>
                                <input type="number" id="costingMaterialWaste" value="0" min="0" placeholder="0" title="Ph·∫ßn trƒÉm hao h·ª•t cho v·∫≠t t∆∞ n√†y trong qu√° tr√¨nh s·∫£n xu·∫•t (v√≠ d·ª•: 10% th√¨ nh·∫≠p 10).">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button id="addCostingMaterialButton" class="small-btn primary-action-btn" title="Th√™m v·∫≠t t∆∞ n√†y v√†o b·∫£ng chi ph√≠ v·∫≠t t∆∞ c·ªßa phi·∫øu t√≠nh gi√°.">+ V·∫≠t T∆∞</button>
                            <button id="saveMaterialToLibraryButton" class="small-btn primary-action-btn" title="L∆∞u th√¥ng tin v·∫≠t t∆∞ n√†y (T√™n, Quy c√°ch, ƒêVT, K.Th∆∞·ªõc VT, ƒê∆°n gi√°) v√†o Th∆∞ vi·ªán V·∫≠t t∆∞ chung ƒë·ªÉ d·ªÖ d√†ng t√°i s·ª≠ d·ª•ng cho c√°c phi·∫øu t√≠nh gi√° kh√°c.">L∆∞u v√†o TV</button>
                            <button id="cancelEditMaterialButton" class="small-btn clear-btn" style="display:none;" title="H·ªßy b·ªè c√°c thay ƒë·ªïi ƒëang s·ª≠a cho v·∫≠t t∆∞.">H·ªßy S·ª≠a VT</button>
                        </div>
                    </div>
                </details>
                <div class="table-responsive styled-table-container" style="margin-top:0;">
                    <table id="costingMaterialsTable" class="styled-table">
                        <thead>
                            <tr>
                                <th style="width:4%;">STT</th>
                                <th>T√™n V·∫≠t t∆∞</th>
                                <th style="width:15%;">Quy c√°ch</th>
                                 <th style="width:10%;">L.K·∫øt SL</th>
                                <th style="width:7%;">ƒêVT</th>
                                <th style="width:8%; text-align:right;">SL / H·ªá s·ªë</th>
                                <th style="width:10%; text-align:right;">ƒê∆°n gi√°</th>
                                <th style="width:7%; text-align:right;">% HH</th>
                                <th style="width:12%; text-align:right;">Th√†nh ti·ªÅn</th>
                                <th class="no-print action-trigger-cell-header" style="width:5%;">...</th>
                            </tr>
                        </thead>
                        <tbody id="costingMaterialsList"></tbody>
                    </table>
                </div>
                <div class="total-section-minimal">
                    <strong>T·ªïng Chi ph√≠ V·∫≠t t∆∞: <span id="totalDirectMaterialsCostSpan">0 VNƒê</span></strong>
                </div>
            </section>

            <hr class="section-divider">

            <!-- 3. Chi ph√≠ Nh√¢n c√¥ng Tr·ª±c ti·∫øp (NCTT) -->
            <section class="costing-labor-section">
                <details class="collapsible-form-section no-print" id="costingLaborFormDetails" open>
                    <summary class="costing-section-summary" title="Nh·∫•n ƒë·ªÉ Hi·ªán/·∫®n form nh·∫≠p li·ªáu chi ti·∫øt nh√¢n c√¥ng.">
                         <h3>Chi ph√≠ Nh√¢n c√¥ng Tr·ª±c ti·∫øp (NCTT) <svg class="summary-toggle-svg" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z"/></svg></h3>
                    </summary>
                     <div id="costingLaborEntryForm" class="item-entry-form-box" style="margin-top: 10px;">
                        <input type="hidden" id="editingLaborIdInput">
                        <div class="item-grid" style="grid-template-columns: 2fr 1fr 1fr; gap:10px; align-items: end;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="costingLaborDescription">C√¥ng ƒëo·∫°n:</label>
                                <input type="text" id="costingLaborDescription" placeholder="C·∫Øt v√°n, D√°n c·∫°nh, S∆°n PU, L·∫Øp LED..." title="T√™n c√¥ng ƒëo·∫°n ho·∫∑c lo·∫°i nh√¢n c√¥ng (v√≠ d·ª•: C·∫Øt CNC, S∆°n PU, L·∫Øp ƒë·∫∑t t·∫°i c√¥ng tr√¨nh).">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="costingLaborHours">S·ªë gi·ªù:</label>
                                <input type="number" id="costingLaborHours" placeholder="0" min="0" step="any" title="T·ªïng s·ªë gi·ªù c√¥ng cho c√¥ng ƒëo·∫°n n√†y ƒë·ªÉ s·∫£n xu·∫•t ra 'S·ªë l∆∞·ª£ng S·∫£n xu·∫•t' ·ªü tr√™n.">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="costingLaborRate">ƒê∆°n gi√°/gi·ªù (VNƒê):</label>
                                <input type="number" id="costingLaborRate" placeholder="0" min="0" title="ƒê∆°n gi√° nh√¢n c√¥ng theo gi·ªù cho c√¥ng ƒëo·∫°n n√†y.">
                            </div>
                        </div>
                         <div class="form-actions" style="margin-top:10px;">
                            <button id="addCostingLaborButton" class="small-btn primary-action-btn" title="Th√™m chi ph√≠ nh√¢n c√¥ng n√†y v√†o b·∫£ng.">+ N.C√¥ng</button>
                            <button id="cancelEditLaborButton" class="small-btn clear-btn" style="display:none;" title="H·ªßy b·ªè c√°c thay ƒë·ªïi ƒëang s·ª≠a cho nh√¢n c√¥ng.">H·ªßy S·ª≠a NC</button>
                        </div>
                    </div>
                </details>
                <div class="table-responsive styled-table-container" style="margin-top:0;">
                    <table id="costingLaborTable" class="styled-table">
                        <thead>
                            <tr>
                                <th style="width:5%;">STT</th>
                                <th>C√¥ng ƒëo·∫°n</th>
                                <th style="width:12%; text-align:right;">S·ªë gi·ªù</th>
                                <th style="width:15%; text-align:right;">ƒê∆°n gi√°/gi·ªù</th>
                                <th style="width:18%; text-align:right;">Th√†nh ti·ªÅn</th>
                                <th class="no-print action-trigger-cell-header" style="width:5%;">...</th>
                            </tr>
                        </thead>
                        <tbody id="costingLaborList"></tbody>
                    </table>
                </div>
                <div class="total-section-minimal">
                    <strong>T·ªïng Chi ph√≠ NCTT: <span id="totalDirectLaborCostSpan">0 VNƒê</span></strong>
                </div>
            </section>
            
            <hr class="section-divider">

            <!-- 4. Chi ph√≠ Gi√°n ti·∫øp ∆Ø·ªõc t√≠nh (SXC, QLDN, BH&M) -->
            <section class="costing-indirect-costs-section">
                <h3>Chi ph√≠ Gi√°n ti·∫øp ∆Ø·ªõc t√≠nh</h3>
                <div class="item-grid" style="grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="costingOverheadTotal">T·ªïng Chi ph√≠ SXC (VNƒê):</label>
                        <input type="number" id="costingOverheadTotal" placeholder="0" min="0" title="T·ªïng chi ph√≠ s·∫£n xu·∫•t chung ∆∞·ªõc t√≠nh cho to√†n b·ªô l√¥ s·∫£n ph·∫©m (v√≠ d·ª•: ƒëi·ªán, n∆∞·ªõc, thu√™ nh√† x∆∞·ªüng ph√¢n b·ªï, kh·∫•u hao m√°y m√≥c).">
                    </div>
                    <div class="form-group">
                        <label for="costingManagementCostTotal">T·ªïng Chi ph√≠ QLDN (VNƒê):</label>
                        <input type="number" id="costingManagementCostTotal" placeholder="0" min="0" title="T·ªïng chi ph√≠ qu·∫£n l√Ω doanh nghi·ªáp ∆∞·ªõc t√≠nh (v√≠ d·ª•: l∆∞∆°ng vƒÉn ph√≤ng, thu√™ vƒÉn ph√≤ng, chi ph√≠ h√†nh ch√≠nh).">
                    </div>
                    <div class="form-group">
                        <label for="costingSalesMarketingCostTotal">T·ªïng Chi ph√≠ BH&M (VNƒê):</label>
                        <input type="number" id="costingSalesMarketingCostTotal" placeholder="0" min="0" title="T·ªïng chi ph√≠ b√°n h√†ng v√† marketing ∆∞·ªõc t√≠nh (v√≠ d·ª•: qu·∫£ng c√°o, hoa h·ªìng, chi ph√≠ h·ªôi ch·ª£).">
                    </div>
                </div>
            </section>

            <hr class="section-divider">
            
            <!-- 5. Chi ph√≠ Kh√°c (V·∫≠n chuy·ªÉn, l·∫Øp ƒë·∫∑t,...) -->
            <section class="costing-other-costs-section">
                 <details class="collapsible-form-section no-print" id="costingOtherCostFormDetails" open>
                    <summary class="costing-section-summary" title="Nh·∫•n ƒë·ªÉ Hi·ªán/·∫®n form nh·∫≠p li·ªáu chi ti·∫øt chi ph√≠ kh√°c.">
                        <h3>Chi ph√≠ Kh√°c (V·∫≠n chuy·ªÉn, l·∫Øp ƒë·∫∑t,...) <svg class="summary-toggle-svg" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z"/></svg></h3>
                    </summary>
                    <div id="costingOtherCostEntryForm" class="item-entry-form-box" style="margin-top: 10px;">
                        <input type="hidden" id="editingOtherCostIdInput">
                        <div class="item-grid" style="grid-template-columns: 2fr 1fr; gap:10px; align-items: end;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="costingOtherCostDescription">N·ªôi dung chi ph√≠:</label>
                                <input type="text" id="costingOtherCostDescription" placeholder="VD: Chi ph√≠ v·∫≠n chuy·ªÉn, l·∫Øp ƒë·∫∑t,..." title="N·ªôi dung c√°c chi ph√≠ ph√°t sinh kh√°c kh√¥ng thu·ªôc v·∫≠t t∆∞, nh√¢n c√¥ng hay s·∫£n xu·∫•t chung (v√≠ d·ª•: v·∫≠n chuy·ªÉn, bao b√¨ ƒë·∫∑c bi·ªát, chi ph√≠ thi·∫øt k·∫ø thu√™ ngo√†i).">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="costingOtherCostAmount">S·ªë ti·ªÅn (VNƒê):</label>
                                <input type="number" id="costingOtherCostAmount" placeholder="0" min="0" title="S·ªë ti·ªÅn c·ªßa chi ph√≠ kh√°c n√†y cho to√†n b·ªô l√¥ s·∫£n ph·∫©m.">
                            </div>
                        </div>
                         <div class="form-actions" style="margin-top:10px;">
                            <button id="addCostingOtherCostButton" class="small-btn primary-action-btn" title="Th√™m chi ph√≠ n√†y v√†o b·∫£ng.">+ Th√™m C.Ph√≠ Kh√°c</button>
                            <button id="cancelEditOtherCostButton" class="small-btn clear-btn" style="display:none;" title="H·ªßy b·ªè c√°c thay ƒë·ªïi ƒëang s·ª≠a cho chi ph√≠ kh√°c.">H·ªßy S·ª≠a CPK</button>
                        </div>
                    </div>
                </details>
                <div class="table-responsive styled-table-container" style="margin-top:0;">
                    <table id="costingOtherCostsTable" class="styled-table">
                        <thead>
                            <tr>
                                <th style="width:5%;">STT</th>
                                <th>N·ªôi dung chi ph√≠</th>
                                <th style="width:25%; text-align:right;">S·ªë ti·ªÅn (VNƒê)</th>
                                <th class="no-print action-trigger-cell-header" style="width:5%;">...</th>
                            </tr>
                        </thead>
                        <tbody id="costingOtherCostsList"></tbody>
                    </table>
                </div>
                <div class="total-section-minimal">
                    <strong>T·ªïng Chi ph√≠ Kh√°c: <span id="totalOtherCostsSpan">0 VNƒê</span></strong>
                </div>
            </section>
            
            <hr style="border-style: dashed; margin: 25px 0;">

            <!-- 6. K·∫øt qu·∫£ T√≠nh to√°n Gi√° -->
            <section class="results-section">
                <h3>K·∫øt qu·∫£ T√≠nh to√°n Gi√°</h3>
                <p>T·ªïng Chi Ph√≠: <strong id="totalCostSpan">0 VNƒê</strong></p>
                <p style="font-size: 1.2em; color: var(--danger-color); font-weight: 700;">Gi√° v·ªën ƒê∆°n v·ªã S·∫£n ph·∫©m: <strong id="unitCostSpan">0 VNƒê</strong></p>
            </section>

             <!-- What-If Scenario Analysis Section -->
            <section id="costingWhatIfSection" class="what-if-scenario-section no-print">
                <h3>Ph√¢n t√≠ch K·ªãch b·∫£n Gi√° ("What-If")</h3>
                <p><em>ƒêi·ªÅu ch·ªânh % thay ƒë·ªïi cho c√°c m·ª•c chi ph√≠ d∆∞·ªõi ƒë√¢y ƒë·ªÉ xem gi√° v·ªën ƒë∆°n v·ªã thay ƒë·ªïi nh∆∞ th·∫ø n√†o.</em></p>
                <div class="item-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px 15px;">
                    <div class="form-group">
                        <label for="whatIfMaterialChange">V·∫≠t t∆∞ Tr·ª±c ti·∫øp (% Thay ƒë·ªïi):</label>
                        <input type="number" id="whatIfMaterialChange" value="0" step="0.1" title="Nh·∫≠p % thay ƒë·ªïi, v√≠ d·ª•: 5 cho tƒÉng 5%, -10 cho gi·∫£m 10%.">
                    </div>
                    <div class="form-group">
                        <label for="whatIfLaborChange">Nh√¢n c√¥ng Tr·ª±c ti·∫øp (% Thay ƒë·ªïi):</label>
                        <input type="number" id="whatIfLaborChange" value="0" step="0.1" title="Nh·∫≠p % thay ƒë·ªïi cho t·ªïng chi ph√≠ nh√¢n c√¥ng.">
                    </div>
                    <div class="form-group">
                        <label for="whatIfOverheadChange">S·∫£n xu·∫•t Chung (% Thay ƒë·ªïi):</label>
                        <input type="number" id="whatIfOverheadChange" value="0" step="0.1" title="Nh·∫≠p % thay ƒë·ªïi cho t·ªïng chi ph√≠ s·∫£n xu·∫•t chung.">
                    </div>
                    <div class="form-group">
                        <label for="whatIfManagementChange">QLDN (% Thay ƒë·ªïi):</label>
                        <input type="number" id="whatIfManagementChange" value="0" step="0.1" title="Nh·∫≠p % thay ƒë·ªïi cho t·ªïng chi ph√≠ QLDN.">
                    </div>
                    <div class="form-group">
                        <label for="whatIfSalesMarketingChange">BH&M (% Thay ƒë·ªïi):</label>
                        <input type="number" id="whatIfSalesMarketingChange" value="0" step="0.1" title="Nh·∫≠p % thay ƒë·ªïi cho t·ªïng chi ph√≠ BH&M.">
                    </div>
                </div>
                <div class="form-actions" style="justify-content: flex-start; margin-top: 15px;">
                    <button id="calculateWhatIfButton" class="small-btn primary-action-btn" title="T√≠nh to√°n l·∫°i gi√° v·ªën d·ª±a tr√™n c√°c k·ªãch b·∫£n thay ƒë·ªïi chi ph√≠.">T√≠nh K·ªãch B·∫£n</button>
                </div>
                <div id="whatIfResultsContainer" class="what-if-results" style="margin-top: 15px;">
                    <p>Gi√° v·ªën ƒê∆°n v·ªã (K·ªãch b·∫£n): <strong id="whatIfUnitCostSpan">0 VNƒê</strong></p>
                    <p>Ch√™nh l·ªách so v·ªõi G·ªëc: <strong id="whatIfDifferenceSpan">0 VNƒê</strong></p>
                </div>
            </section>
            
            <!-- 7. Actions -->
            <footer style="margin-top: 25px;" class="no-print form-actions">
                <button id="saveCostingAsTemplateButton" class="small-btn" title="L∆∞u phi·∫øu t√≠nh gi√° n√†y th√†nh m·ªôt m·∫´u ƒë·ªÉ t√°i s·ª≠ d·ª•ng.">L∆∞u M·∫´u PGT</button>
                <button id="calculateCostingButton" class="primary-action-btn" title="T√≠nh to√°n l·∫°i to√†n b·ªô chi ph√≠ v√† gi√° th√†nh d·ª±a tr√™n c√°c s·ªë li·ªáu ƒë√£ nh·∫≠p.">T√≠nh Gi√°</button>
                <button id="saveCostingButton" class="save-btn" title="L∆∞u l·∫°i to√†n b·ªô th√¥ng tin c·ªßa phi·∫øu t√≠nh gi√° n√†y l√™n ƒë√°m m√¢y ƒë·ªÉ s·ª≠ d·ª•ng l·∫°i ho·∫∑c tham kh·∫£o.">L∆∞u Phi·∫øu</button>
                <button id="clearCostingFormButton" class="clear-btn" title="X√≥a to√†n b·ªô d·ªØ li·ªáu tr√™n form t√≠nh gi√° ƒë·ªÉ b·∫Øt ƒë·∫ßu m·ªôt phi·∫øu m·ªõi.">L√†m M·ªõi</button>
            </footer>

            <hr class="section-divider" style="margin-top: 30px; margin-bottom: 15px;">
            
            <!-- 8. Phi·∫øu T√≠nh Gi√° ƒê√£ L∆∞u -->
            <section id="savedCostingsSection" class="no-print">
                <h2>Phi·∫øu T√≠nh Gi√° ƒê√£ L∆∞u</h2>
                <div class="table-container-scrollable styled-table-container">
                    <table id="savedCostingsTable" class="styled-table">
                        <thead>
                            <tr>
                                <th style="width:5%;">STT</th>
                                <th>T√™n S·∫£n ph·∫©m</th>
                                <th>Ng√†y t·∫°o</th>
                                <th>Gi√° v·ªën ƒêVSP</th>
                                <th class="no-print action-trigger-cell-header" style="width:5%;">...</th>
                            </tr>
                        </thead>
                        <tbody id="savedCostingsList">
                        </tbody>
                    </table>
                </div>
            </section>

            <hr class="section-divider" style="margin-top: 30px; margin-bottom: 15px;">
            
            <!-- 9. Th∆∞ vi·ªán V·∫≠t t∆∞ -->
            <section id="materialsLibrarySection" class="no-print">
                <h2>Th∆∞ vi·ªán V·∫≠t t∆∞ (<span id="materialsLibraryCountSpan">0</span> v·∫≠t t∆∞)</h2>
                 <div class="form-group">
                    <label for="materialsLibrarySearchInput">T√¨m v·∫≠t t∆∞ trong th∆∞ vi·ªán:</label>
                    <input type="text" id="materialsLibrarySearchInput" placeholder="G√µ t√™n ho·∫∑c quy c√°ch v·∫≠t t∆∞..." title="L·ªçc danh s√°ch v·∫≠t t∆∞ trong th∆∞ vi·ªán theo t√™n ho·∫∑c quy c√°ch.">
                </div>
                <div class="table-container-scrollable styled-table-container" style="max-height: 250px;">
                    <table id="materialsLibraryTable" class="styled-table">
                        <thead>
                            <tr>
                                <th style="width:5%;">STT</th>
                                <th>T√™n V·∫≠t t∆∞</th>
                                <th style="width:20%;">Quy c√°ch</th>
                                <th style="width:10%;">ƒêVT</th>
                                <th style="width:12%; text-align:right;">ƒê∆°n gi√°</th>
                                <th style="width:15%;">K.Th∆∞·ªõc VT</th>
                                <th class="no-print action-trigger-cell-header" style="width:5%;">...</th>
                            </tr>
                        </thead>
                        <tbody id="materialsLibraryList"></tbody>
                    </table>
                </div>
            </section>
        </main>

        <!-- Tab B√°o Gi√° ƒê√£ L∆∞u -->
        <main id="tabSavedQuotes" class="tab-content" role="tabpanel" aria-labelledby="tabSavedQuotesButton">
            <h2>Danh s√°ch B√°o gi√° ƒê√£ l∆∞u</h2>
            
            <section class="search-filter-container no-print">
                <div class="form-group">
                    <label for="savedQuotesSearchInput">T√¨m theo ID BG/T√™n Kh√°ch:</label>
                    <input type="text" id="savedQuotesSearchInput" placeholder="Nh·∫≠p ID ho·∫∑c T√™n kh√°ch h√†ng..." title="L·ªçc danh s√°ch b√°o gi√° theo ID B√°o gi√° ho·∫∑c T√™n Kh√°ch h√†ng.">
                </div>
                <div class="item-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
                    <div class="form-group">
                        <label for="savedQuotesStartDateFilter">T·ª´ ng√†y:</label>
                        <input type="date" id="savedQuotesStartDateFilter" title="L·ªçc b√°o gi√° c√≥ ng√†y t·∫°o t·ª´ ng√†y n√†y tr·ªü ƒëi.">
                    </div>
                    <div class="form-group">
                        <label for="savedQuotesEndDateFilter">ƒê·∫øn ng√†y:</label>
                        <input type="date" id="savedQuotesEndDateFilter" title="L·ªçc b√°o gi√° c√≥ ng√†y t·∫°o ƒë·∫øn ng√†y n√†y.">
                    </div>
                    <div class="form-group">
                        <label for="savedQuotesMinTotalFilter">T·ªïng gi√° tr·ªã t·ª´ (VNƒê):</label>
                        <input type="number" id="savedQuotesMinTotalFilter" placeholder="0" min="0" title="L·ªçc b√°o gi√° c√≥ t·ªïng gi√° tr·ªã l·ªõn h∆°n ho·∫∑c b·∫±ng s·ªë n√†y.">
                    </div>
                    <div class="form-group">
                        <label for="savedQuotesMaxTotalFilter">ƒê·∫øn (VNƒê):</label>
                        <input type="number" id="savedQuotesMaxTotalFilter" placeholder="Kh√¥ng gi·ªõi h·∫°n" min="0" title="L·ªçc b√°o gi√° c√≥ t·ªïng gi√° tr·ªã nh·ªè h∆°n ho·∫∑c b·∫±ng s·ªë n√†y.">
                    </div>
                    <div class="form-group">
                        <label for="savedQuotesStatusFilter">Tr·∫°ng th√°i:</label>
                        <select id="savedQuotesStatusFilter" title="L·ªçc b√°o gi√° theo tr·∫°ng th√°i hi·ªán t·∫°i c·ªßa ch√∫ng.">
                            <option value="all">-- T·∫•t c·∫£ tr·∫°ng th√°i --</option>
                            <option value="draft">So·∫°n th·∫£o</option>
                            <option value="sent">ƒê√£ g·ª≠i</option>
                            <option value="accepted">ƒê√£ ch·∫•p nh·∫≠n</option>
                            <option value="rejected">ƒê√£ t·ª´ ch·ªëi</option>
                            <option value="expired">ƒê√£ h·∫øt h·∫°n</option>
                        </select>
                    </div>
                </div>
            </section>

            <div class="table-container-scrollable styled-table-container">
                <table id="savedQuotesTable" class="styled-table">
                    <thead><tr><th>ID B√°o gi√°</th><th>Kh√°ch h√†ng</th><th>Ng√†y t·∫°o</th><th>T·ªïng ti·ªÅn</th><th>Tr·∫°ng th√°i</th><th class="no-print action-trigger-cell-header" style="width:5%;">...</th></tr></thead>
                    <tbody id="savedQuotesList"></tbody>
                </table>
            </div>
            
            <div id="load-more-container" class="no-print" style="text-align: center; margin-top: 15px;">
                <button id="loadMoreQuotesButton" class="small-btn" title="T·∫£i th√™m c√°c b√°o gi√° c≈© h∆°n (n·∫øu c√≥).">T·∫£i Th√™m</button>
            </div>
        </main>

        <!-- Tab Qu·∫£n L√Ω -->
        <main id="tabCatalog" class="tab-content" role="tabpanel" aria-labelledby="tabCatalogButton">
            <h2>Qu·∫£n L√Ω Danh M·ª•c S·∫£n ph·∫©m/D·ªãch v·ª•</h2>
            <section class="catalog-import-section">
                <div class="item-grid" style="grid-template-columns: 1fr auto; gap: 15px; align-items: center; margin-bottom: 20px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="excelFileManage" style="margin-bottom: 5px;" title="Ch·ªçn file Excel (.xlsx, .xls, .csv) ch·ª©a danh m·ª•c s·∫£n ph·∫©m/d·ªãch v·ª• c·ªßa b·∫°n. File c·∫ßn c√≥ c√°c c·ªôt: TenHangMuc, DonViTinh, DonGia. T√πy ch·ªçn: QuyCach, DanhMucChinh.">1. T·∫£i l√™n danh m·ª•c t·ª´ file Excel (.xlsx, .xls, .csv):</label>
                        <input type="file" id="excelFileManage" accept=".xlsx, .xls, .csv" style="display: none;" class="file-input" title="Ch·ªçn file Excel (.xlsx, .xls, .csv) ch·ª©a danh m·ª•c s·∫£n ph·∫©m/d·ªãch v·ª• c·ªßa b·∫°n.">
                        <p style="font-size:0.85em; color:var(--text-secondary-color); margin: 0;"><i>File Excel c·∫ßn c√≥ c·ªôt: `TenHangMuc`, `DonViTinh`, `DonGia`.</i></p>
                    </div>
                     <button id="reloadExcelButton" class="reload-excel-btn no-print primary-action-btn" title="M·ªü h·ªôp tho·∫°i ƒë·ªÉ ch·ªçn v√† t·∫£i l√™n file danh m·ª•c t·ª´ m√°y t√≠nh." style="height: fit-content; margin: 0;">T·∫£i File DM</button>
                </div>
            </section>

            <section class="catalog-filter-section">
                <div class="item-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px 20px; margin-bottom: 15px;">
                    <div class="form-group">
                        <label for="catalogSearchInput">L·ªçc theo T√™n/Quy c√°ch:</label>
                        <input type="text" id="catalogSearchInput" placeholder="G√µ t√™n ho·∫∑c quy c√°ch..." style="width: 100%;" title="L·ªçc nhanh danh m·ª•c hi·ªÉn th·ªã b√™n d∆∞·ªõi theo T√™n H·∫°ng m·ª•c ho·∫∑c Quy c√°ch.">
                    </div>
                    <div class="form-group">
                        <label for="catalogFilterMainCategorySelect">L·ªçc theo Danh m·ª•c ch√≠nh:</label>
                        <select id="catalogFilterMainCategorySelect" title="Ch·ªâ hi·ªÉn th·ªã c√°c h·∫°ng m·ª•c thu·ªôc Danh m·ª•c ch√≠nh ƒë√£ ch·ªçn.">
                            <option value="">-- T·∫•t c·∫£ Danh m·ª•c ch√≠nh --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="catalogMinPriceFilter">Gi√° t·ª´ (VNƒê):</label>
                        <input type="number" id="catalogMinPriceFilter" placeholder="0" min="0" title="L·ªçc h·∫°ng m·ª•c c√≥ ƒë∆°n gi√° l·ªõn h∆°n ho·∫∑c b·∫±ng gi√° tr·ªã n√†y.">
                    </div>
                    <div class="form-group">
                        <label for="catalogMaxPriceFilter">ƒê·∫øn (VNƒê):</label>
                        <input type="number" id="catalogMaxPriceFilter" placeholder="Kh√¥ng gi·ªõi h·∫°n" min="0" title="L·ªçc h·∫°ng m·ª•c c√≥ ƒë∆°n gi√° nh·ªè h∆°n ho·∫∑c b·∫±ng gi√° tr·ªã n√†y.">
                    </div>
                     <div class="form-group">
                        <label for="catalogSortSelect">S·∫Øp x·∫øp theo:</label>
                        <select id="catalogSortSelect" title="S·∫Øp x·∫øp danh s√°ch h·∫°ng m·ª•c theo ti√™u ch√≠ ƒë√£ ch·ªçn.">
                            <option value="name_asc">T√™n A-Z</option>
                            <option value="name_desc">T√™n Z-A</option>
                            <option value="price_asc">Gi√° Th·∫•p-Cao</option>
                            <option value="price_desc">Gi√° Cao-Th·∫•p</option>
                        </select>
                    </div>
                </div>
            </section>

            <section class="catalog-preview-section">
                <h3>Danh m·ª•c hi·ªán t·∫°i (<span id="catalogItemCount">0</span> h·∫°ng m·ª•c)</h3>
                <div class="table-container-scrollable styled-table-container" style="max-height: 300px;">
                    <table id="catalogPreviewTable" class="styled-table">
                        <thead><tr><th>STT</th><th>T√™n H·∫°ng M·ª•c</th><th>Quy C√°ch</th><th>ƒêVT</th><th>ƒê∆°n Gi√°</th><th class="no-print action-trigger-cell-header" style="width:5%;">...</th></tr></thead>
                        <tbody id="catalogPreviewList"></tbody>
                    </table>
                </div>
                <button id="exportCatalogButton" class="save-catalog-btn no-print primary-action-btn" title="Xu·∫•t to√†n b·ªô danh m·ª•c hi·ªán t·∫°i (ƒë√£ l·ªçc, n·∫øu c√≥) ra file Excel.">Xu·∫•t DM (Excel)</button>
            </section>
            
            <hr class="section-divider no-print" style="margin-top: 30px; margin-bottom: 20px;">
            
            <section class="catalog-management-forms">
                <div class="item-grid" style="grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div class="admin-section-box">
                        <h3>Qu·∫£n L√Ω Danh M·ª•c Ch√≠nh</h3>
                        <div class="form-group">
                            <label for="mainCategoryNameInput">T√™n Danh m·ª•c ch√≠nh:</label>
                            <input type="text" id="mainCategoryNameInput" placeholder="V√≠ d·ª•: H·∫°ng m·ª•c S∆°n n∆∞·ªõc" title="Nh·∫≠p t√™n cho Danh m·ª•c ch√≠nh m·ªõi ho·∫∑c t√™n s·ª≠a ƒë·ªïi. Danh m·ª•c ch√≠nh gi√∫p ph√¢n lo·∫°i h·∫°ng m·ª•c s·∫£n ph·∫©m.">
                            <input type="hidden" id="editingMainCategoryId">
                        </div>
                         <div style="margin-bottom: 15px;" class="form-actions">
                            <button id="addOrUpdateMainCategoryButton" class="no-print primary-action-btn" title="L∆∞u Danh m·ª•c ch√≠nh n√†y l√™n ƒë√°m m√¢y.">L∆∞u DM Ch√≠nh</button>
                            <button type="button" id="cancelEditMainCategoryButton" class="clear-btn no-print" style="display:none; margin-left: 5px;" title="H·ªßy b·ªè c√°c thay ƒë·ªïi v√† l√†m m·ªõi form.">H·ªßy S·ª≠a</button>
                        </div>
                        <h4>Danh s√°ch Danh m·ª•c ch√≠nh hi·ªán c√≥ (<span id="mainCategoryCount">0</span>):</h4>
                        <div class="table-container-scrollable styled-table-container" style="max-height: 200px;">
                            <table id="mainCategoriesTable" class="styled-table">
                                <thead><tr><th style="width:10%;">STT</th><th>T√™n Danh m·ª•c ch√≠nh</th><th class="no-print action-trigger-cell-header" style="width:10%;">...</th></tr></thead>
                                <tbody id="mainCategoriesList"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="admin-section-box">
                        <h3>Th√™m / S·ª≠a H·∫°ng m·ª•c trong Danh m·ª•c</h3>
                        <input type="hidden" id="editingCatalogEntryId">
                        <div class="form-group">
                            <label for="catalogEditMainCategorySelect">Danh m·ª•c ch√≠nh:</label>
                            <select id="catalogEditMainCategorySelect" title="Ch·ªçn Danh m·ª•c ch√≠nh cho h·∫°ng m·ª•c n√†y. N·∫øu ch∆∞a c√≥, h√£y t·∫°o ·ªü m·ª•c b√™n tr√°i.">
                                <option value="">-- Ch·ªçn Danh m·ª•c ch√≠nh --</option>
                            </select>
                        </div>
                        <div class="form-group"><label for="catalogEditName">T√™n H·∫°ng m·ª•c:</label><input type="text" id="catalogEditName" title="T√™n c·ªßa s·∫£n ph·∫©m ho·∫∑c d·ªãch v·ª• trong danh m·ª•c."></div>
                        <div class="form-group"><label for="catalogEditSpec">Quy c√°ch/M√¥ t·∫£ chi ti·∫øt:</label><textarea id="catalogEditSpec" rows="2" title="M√¥ t·∫£ quy c√°ch k·ªπ thu·∫≠t, v·∫≠t li·ªáu, m√†u s·∫Øc chi ti·∫øt c·ªßa h·∫°ng m·ª•c."></textarea></div>
                        <div class="item-grid" style="grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group"><label for="catalogEditUnit">ƒê∆°n v·ªã t√≠nh:</label><input type="text" id="catalogEditUnit" title="ƒê∆°n v·ªã t√≠nh cho h·∫°ng m·ª•c n√†y (v√≠ d·ª•: m2, c√°i, b·ªô)."></div>
                            <div class="form-group"><label for="catalogEditPrice">ƒê∆°n gi√° (VNƒê):</label><input type="number" id="catalogEditPrice" min="0" title="ƒê∆°n gi√° cho h·∫°ng m·ª•c n√†y theo ƒêVT ƒë√£ nh·∫≠p."></div>
                        </div>
                        <div class="form-actions">
                            <button id="saveCatalogEntryButton" class="no-print primary-action-btn" title="L∆∞u h·∫°ng m·ª•c n√†y v√†o Danh m·ª•c ch√≠nh ƒë√£ ch·ªçn tr√™n ƒë√°m m√¢y.">L∆∞u v√†o DM</button>
                            <button type="button" id="cancelCatalogEntryEditButton" class="clear-btn no-print" style="display:none;" title="H·ªßy b·ªè c√°c thay ƒë·ªïi v√† l√†m m·ªõi form.">H·ªßy S·ª≠a</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Tab Qu·∫£n L√Ω M·∫´u -->
        <main id="tabTemplateManagement" class="tab-content" role="tabpanel" aria-labelledby="tabTemplateManagementButton">
            <h2>Qu·∫£n l√Ω M·∫´u B√°o Gi√° & Phi·∫øu T√≠nh Gi√°</h2>

            <section id="quoteTemplatesSection" class="template-section">
                <h3>M·∫´u B√°o Gi√° (<span id="quoteTemplateCountSpan">0</span> m·∫´u)</h3>
                <div class="table-container-scrollable styled-table-container">
                    <table id="quoteTemplatesTable" class="styled-table">
                        <thead>
                            <tr>
                                <th style="width:5%;">STT</th>
                                <th>T√™n M·∫´u BG</th>
                                <th style="width:15%; text-align:right;">S·ªë H.M·ª•c</th>
                                <th style="width:15%; text-align:center;">Ng√†y t·∫°o</th>
                                <th class="no-print action-trigger-cell-header" style="width:5%;">...</th>
                            </tr>
                        </thead>
                        <tbody id="quoteTemplatesTableBody">
                            <!-- Template rows will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <hr class="section-divider">

            <section id="costingTemplatesSection" class="template-section">
                <h3>M·∫´u Phi·∫øu T√≠nh Gi√° (<span id="costingTemplateCountSpan">0</span> m·∫´u)</h3>
                <div class="table-container-scrollable styled-table-container">
                    <table id="costingTemplatesTable" class="styled-table">
                        <thead>
                            <tr>
                                <th style="width:5%;">STT</th>
                                <th>T√™n M·∫´u PGT</th>
                                <th style="width:15%; text-align:right;">S·ªë V·∫≠t T∆∞</th>
                                <th style="width:15%; text-align:center;">Ng√†y t·∫°o</th>
                                <th class="no-print action-trigger-cell-header" style="width:5%;">...</th>
                            </tr>
                        </thead>
                        <tbody id="costingTemplatesTableBody">
                            <!-- Template rows will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
        
        <!-- Tab C√†i ƒê·∫∑t -->
        <main id="tabSettings" class="tab-content" role="tabpanel" aria-labelledby="tabSettingsButton">
             <h2>C√†i ƒê·∫∑t Th√¥ng Tin C√¥ng Ty</h2>
             <section class="company-info-settings">
                <div class="item-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group"><label for="companyNameSetting">T√™n C√¥ng ty/C√° nh√¢n:</label><input type="text" id="companyNameSetting" title="T√™n c√¥ng ty ho·∫∑c c√° nh√¢n c·ªßa b·∫°n. S·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hi·ªÉn th·ªã tr√™n b√°o gi√° PDF."></div>
                    <div class="form-group"><label for="companyAddressSetting">ƒê·ªãa ch·ªâ:</label><input type="text" id="companyAddressSetting" title="ƒê·ªãa ch·ªâ c√¥ng ty/c√° nh√¢n. S·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hi·ªÉn th·ªã tr√™n b√°o gi√° PDF."></div>
                    <div class="form-group"><label for="companyPhoneSetting">ƒêi·ªán tho·∫°i:</label><input type="text" id="companyPhoneSetting" title="S·ªë ƒëi·ªán tho·∫°i li√™n h·ªá. S·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hi·ªÉn th·ªã tr√™n b√°o gi√° PDF."></div>
                    <div class="form-group"><label for="companyEmailSetting">Email:</label><input type="email" id="companyEmailSetting" title="ƒê·ªãa ch·ªâ email li√™n h·ªá. S·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hi·ªÉn th·ªã tr√™n b√°o gi√° PDF."></div>
                    <div class="form-group"><label for="companyTaxIdSetting">M√£ s·ªë thu·∫ø (N·∫øu c√≥):</label><input type="text" id="companyTaxIdSetting" title="M√£ s·ªë thu·∫ø c·ªßa c√¥ng ty (n·∫øu c√≥). S·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hi·ªÉn th·ªã tr√™n b√°o gi√° PDF."></div>
                    <div class="form-group"><label for="printCreatorNameSetting">T√™n ng∆∞·ªùi l·∫≠p (d√πng cho ch·ªØ k√Ω):</label><input type="text" id="printCreatorNameSetting" placeholder="Nguy·ªÖn VƒÉn A" title="T√™n ng∆∞·ªùi l·∫≠p b√°o gi√°, s·∫Ω hi·ªÉn th·ªã ·ªü ph·∫ßn ch·ªØ k√Ω tr√™n PDF."></div>
                 </div>

                 <div class="form-group">
                     <label for="companyBankAccountSetting">Th√¥ng tin chuy·ªÉn kho·∫£n (Ng√¢n h√†ng, STK, Ch·ªß TK):</label>
                     <textarea id="companyBankAccountSetting" rows="3" title="Th√¥ng tin t√†i kho·∫£n ng√¢n h√†ng ƒë·ªÉ kh√°ch h√†ng thanh to√°n. S·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ hi·ªÉn th·ªã tr√™n b√°o gi√° PDF."></textarea>
                 </div>
                 
                 <div class="form-group">
                     <label for="defaultNotesSetting">Ghi ch√∫ m·∫∑c ƒë·ªãnh cho b√°o gi√° m·ªõi:</label>
                     <textarea id="defaultNotesSetting" rows="3" title="N·ªôi dung ghi ch√∫ n√†y s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c th√™m v√†o c√°c b√°o gi√° m·ªõi t·∫°o. B·∫°n v·∫´n c√≥ th·ªÉ s·ª≠a ƒë·ªïi tr√™n t·ª´ng b√°o gi√°."></textarea>
                 </div>

                 <div class="form-group">
                    <label for="companyLogoFile">Logo (·∫£nh nh·ªè, <1MB):</label><input type="file" id="companyLogoFile" accept="image/*" class="file-input" title="T·∫£i l√™n logo c√¥ng ty (khuy·∫øn ngh·ªã ·∫£nh nh·ªè, d∆∞·ªõi 1MB). Logo s·∫Ω xu·∫•t hi·ªán ·ªü ƒë·∫ßu b√°o gi√° PDF."><img id="logoPreview" src="#" alt="Logo Preview" class="image-preview">
                 </div>
            </section>
             
             <hr class="section-divider" style="margin: 25px 0;">
             <section class="pdf-customization-settings">
                <h2>T√πy ch·ªânh In ·∫•n & Hi·ªÉn th·ªã PDF</h2>
                  <div class="item-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="printTitleSetting">Ti√™u ƒë·ªÅ b√°o gi√° PDF (v√≠ d·ª•: B√ÅO GI√Å, B·∫¢NG D·ª∞ TO√ÅN,...):</label>
                        <input type="text" id="printTitleSetting" placeholder="B√ÅO GI√Å" title="Ti√™u ƒë·ªÅ ch√≠nh s·∫Ω hi·ªÉn th·ªã ·ªü ƒë·∫ßu b√°o gi√° PDF (v√≠ d·ª•: B√ÅO GI√Å, PHI·∫æU CH√ÄO GI√Å, B·∫¢NG D·ª∞ TO√ÅN).">
                    </div>
                </div>
                
                <div class="setting-group-box">
                    <label class="setting-group-label">T√πy ch·ªçn Logo & Footer PDF:</label>
                    <div class="form-group">
                        <label for="printFooterSetting">N·ªôi dung ch√¢n trang (hi·ªÉn th·ªã ·ªü cu·ªëi b·∫£n PDF):</label>
                        <textarea id="printFooterSetting" rows="2" title="N·ªôi dung n√†y s·∫Ω xu·∫•t hi·ªán ·ªü ch√¢n m·ªói trang c·ªßa b√°o gi√° PDF (v√≠ d·ª•: th√¥ng tin li√™n h·ªá ng·∫Øn g·ªçn, website, slogan)."></textarea>
                    </div>
                </div>
                 <!-- Removed section for hiding/showing PDF columns -->
            </section>
             
            <footer class="form-actions">
                <button id="saveCompanySettingsButton" class="save-btn" style="margin-top: 15px;" title="L∆∞u t·∫•t c·∫£ c√°c c√†i ƒë·∫∑t th√¥ng tin c√¥ng ty v√† t√πy ch·ªânh PDF l√™n ƒë√°m m√¢y.">L∆∞u C√†i ƒê·∫∑t Chung</button>
             </footer>
             
             <hr class="section-divider" style="margin: 25px 0;">
             <section id="account-info-container" style="display: none;">
                <h3>Th√¥ng Tin T√†i Kho·∫£n</h3>
                <div id="account-info-details" class="account-details-box">
                    <p>ƒêang t·∫£i th√¥ng tin...</p>
                </div>
             </section>

             <hr class="section-divider" style="margin: 25px 0;">
             <section id="data-backup-restore-section" class="setting-group-box">
                <label class="setting-group-label">Sao l∆∞u & Kh√¥i ph·ª•c D·ªØ li·ªáu</label>
                <p style="font-size:0.9em; color:var(--text-secondary-color);">Sao l∆∞u to√†n b·ªô d·ªØ li·ªáu ·ª©ng d·ª•ng c·ªßa b·∫°n (B√°o gi√°, PGT, Danh m·ª•c, C√†i ƒë·∫∑t, v.v.) ra m·ªôt file JSON. B·∫°n c√≥ th·ªÉ d√πng file n√†y ƒë·ªÉ kh√¥i ph·ª•c d·ªØ li·ªáu sau n√†y.</p>
                <div class="form-actions" style="margin-bottom: 15px; justify-content: flex-start;">
                    <button id="backupDataButton" class="primary-action-btn small-btn" title="Sao l∆∞u to√†n b·ªô d·ªØ li·ªáu ra file JSON.">
                        <svg class="icon-svg icon-inline" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M.5 9.9a.5.5 0 01.5.5v2.5a1 1 0 001 1h12a1 1 0 001-1v-2.5a.5.5 0 011 0v2.5a2 2 0 01-2 2H2a2 2 0 01-2-2v-2.5a.5.5 0 01.5-.5z"/><path d="M7.646 11.854a.5.5 0 00.708 0l3-3a.5.5 0 00-.708-.708L8.5 10.293V1.5a.5.5 0 00-1 0v8.793L5.354 8.146a.5.5 0 10-.708.708l3 3z"/></svg>
                        Sao l∆∞u D·ªØ li·ªáu
                    </button>
                </div>

                <hr class="form-section-divider-subtle">
                <p style="font-size:0.9em; color:var(--text-secondary-color); margin-top: 15px;">Kh√¥i ph·ª•c d·ªØ li·ªáu t·ª´ m·ªôt file JSON ƒë√£ sao l∆∞u tr∆∞·ªõc ƒë√≥.</p>
                <p style="font-size:0.95em; color:var(--danger-color); font-weight: bold;">C·∫¢NH B√ÅO: H√†nh ƒë·ªông kh√¥i ph·ª•c s·∫Ω GHI ƒê√à to√†n b·ªô d·ªØ li·ªáu hi·ªán t·∫°i c·ªßa b·∫°n trong ·ª©ng d·ª•ng b·∫±ng d·ªØ li·ªáu t·ª´ file sao l∆∞u. H√†nh ƒë·ªông n√†y KH√îNG TH·ªÇ HO√ÄN T√ÅC. H√£y ch·∫Øc ch·∫Øn b·∫°n ƒë√£ ch·ªçn ƒë√∫ng file v√† hi·ªÉu r√µ r·ªßi ro.</p>
                
                <div class="form-group" style="margin-top: 10px;">
                    <label for="restoreDataFile" style="margin-bottom: 5px;">Ch·ªçn file sao l∆∞u (.json):</label>
                    <input type="file" id="restoreDataFile" accept=".json" class="file-input" title="Ch·ªçn file .json ƒë√£ sao l∆∞u tr∆∞·ªõc ƒë√≥ ƒë·ªÉ kh√¥i ph·ª•c.">
                </div>
                <div class="form-actions" style="justify-content: flex-start;">
                     <button id="restoreDataButton" class="danger-btn small-btn" disabled title="Kh√¥i ph·ª•c d·ªØ li·ªáu t·ª´ file ƒë√£ ch·ªçn. N√öT N√ÄY S·∫º GHI ƒê√à D·ªÆ LI·ªÜU HI·ªÜN T·∫†I!">
                        <svg class="icon-svg icon-inline" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M.5 9.9a.5.5 0 01.5.5v2.5a1 1 0 001 1h12a1 1 0 001-1v-2.5a.5.5 0 011 0v2.5a2 2 0 01-2 2H2a2 2 0 01-2-2v-2.5a.5.5 0 01.5-.5z"/><path d="M7.646 1.146a.5.5 0 01.708 0l3 3a.5.5 0 01-.708.708L8.5 2.707V11.5a.5.5 0 01-1 0V2.707L5.354 4.854a.5.5 0 11-.708-.708l3-3z"/></svg>
                        Kh√¥i ph·ª•c t·ª´ File
                    </button>
                </div>
                <p id="restoreDataStatus" class="status-message" style="margin-top:10px;"></p>
            </section>
        </main>

        <!-- Tab Qu·∫£n tr·ªã -->
        <main id="tabAdmin" class="tab-content" role="tabpanel" aria-labelledby="tabAdminButton">
            <h2>Qu·∫£n l√Ω Ng∆∞·ªùi d√πng & H·ªá th·ªëng</h2>

            <section class="admin-global-settings admin-section-box">
                <h4>C√†i ƒë·∫∑t To√†n c·ª•c</h4>
                <div class="form-group">
                    <label for="admin-default-trial-days">S·ªë ng√†y d√πng th·ª≠ m·∫∑c ƒë·ªãnh cho t√†i kho·∫£n m·ªõi:</label>
                    <input type="number" id="admin-default-trial-days" min="1" placeholder="V√≠ d·ª•: 7" title="S·ªë ng√†y d√πng th·ª≠ m·∫∑c ƒë·ªãnh s·∫Ω ƒë∆∞·ª£c √°p d·ª•ng cho t·∫•t c·∫£ t√†i kho·∫£n m·ªõi ƒëƒÉng k√Ω.">
                </div>
                <button id="admin-save-global-settings-button" class="save-btn small-btn" title="L∆∞u c√†i ƒë·∫∑t s·ªë ng√†y d√πng th·ª≠ m·∫∑c ƒë·ªãnh.">L∆∞u C√†i ƒë·∫∑t To√†n c·ª•c</button>
                <p id="admin-global-settings-status" class="status-message"></p>
            </section>

            <hr class="section-divider">
            
            <section class="admin-statistics admin-section-box">
                <h4>Th·ªëng k√™ Ng∆∞·ªùi d√πng</h4>
                <button id="admin-refresh-stats-button" class="small-btn primary-action-btn" title="L√†m m·ªõi c√°c s·ªë li·ªáu th·ªëng k√™ ng∆∞·ªùi d√πng.">L√†m m·ªõi Th·ªëng k√™</button>
                <div id="admin-stats-display" style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px;">
                    <p>T·ªïng s·ªë ng∆∞·ªùi d√πng: <strong id="stats-total-users">N/A</strong></p>
                    <p>ƒêang ho·∫°t ƒë·ªông: <strong id="stats-active-users">N/A</strong></p>
                    <p>H·∫øt h·∫°n/Kh√≥a: <strong id="stats-expired-locked-users">N/A</strong></p>
                    <p>M·ªõi trong 7 ng√†y: <strong id="stats-new-last-7-days">N/A</strong></p>
                </div>
                <small class="admin-note"><i>L∆∞u √Ω: Th·ªëng k√™ ƒë∆∞·ª£c t·ªïng h·ª£p t·ª´ ph√≠a client v√† c√≥ th·ªÉ m·∫•t ch√∫t th·ªùi gian n·∫øu s·ªë l∆∞·ª£ng ng∆∞·ªùi d√πng l·ªõn.</i></small>
            </section>
            
            <hr class="section-divider">

            <section class="admin-user-management admin-section-box">
                <h4>Qu·∫£n l√Ω T√†i kho·∫£n Ng∆∞·ªùi d√πng Chi ti·∫øt</h4>
                <div class="form-group">
                    <label for="admin-search-user-input">Nh·∫≠p Email ho·∫∑c User ID c·ªßa ng∆∞·ªùi d√πng c·∫ßn qu·∫£n l√Ω:</label>
                    <div class="input-group">
                        <input type="text" id="admin-search-user-input" placeholder="Nh·∫≠p Email ho·∫∑c User ID..." title="Nh·∫≠p email ho·∫∑c ID c·ªßa ng∆∞·ªùi d√πng ƒë·ªÉ xem v√† c·∫≠p nh·∫≠t th√¥ng tin.">
                        <button id="admin-fetch-user-button" class="input-group-button" title="T√¨m ki·∫øm th√¥ng tin ng∆∞·ªùi d√πng.">T√¨m</button>
                    </div>
                </div>

                <div id="admin-user-details-container" style="display: none; margin-top: 20px;">
                    <h5>Th√¥ng tin t√†i kho·∫£n</h5>
                    <div id="admin-user-details" class="account-details-box"></div>
                    
                    <div class="item-grid" style="grid-template-columns: 1fr 1fr; gap: 20px; margin-top:15px;">
                        <div class="form-group">
                            <label for="admin-days-to-extend">S·ªë ng√†y mu·ªën gia h·∫°n:</label>
                            <input type="number" id="admin-days-to-extend" min="1" placeholder="Nh·∫≠p s·ªë ng√†y" title="Nh·∫≠p s·ªë ng√†y mu·ªën c·ªông th√™m v√†o h·∫°n s·ª≠ d·ª•ng hi·ªán t·∫°i c·ªßa ng∆∞·ªùi d√πng.">
                            <input type="hidden" id="admin-target-user-id">
                        </div>
                        <div class="form-group">
                            <label for="admin-user-status-select">Tr·∫°ng th√°i t√†i kho·∫£n:</label>
                            <select id="admin-user-status-select" title="Ch·ªçn tr·∫°ng th√°i m·ªõi cho t√†i kho·∫£n ng∆∞·ªùi d√πng.">
                                <option value="active_trial">D√πng th·ª≠ (Active Trial)</option>
                                <option value="active_paid">ƒê√£ thanh to√°n (Active Paid)</option>
                                <option value="suspended">T·∫°m ng∆∞ng (Suspended)</option>
                                <option value="disabled">V√¥ hi·ªáu h√≥a (Disabled)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions" style="justify-content: flex-start;">
                        <button id="admin-update-expiry-button" class="save-btn small-btn" title="C·∫≠p nh·∫≠t h·∫°n s·ª≠ d·ª•ng cho ng∆∞·ªùi d√πng ƒë√£ ch·ªçn.">Gia H·∫°n</button>
                        <button id="admin-update-status-button" class="small-btn" title="C·∫≠p nh·∫≠t tr·∫°ng th√°i cho t√†i kho·∫£n ng∆∞·ªùi d√πng.">C·∫≠p nh·∫≠t Tr·∫°ng th√°i</button>
                    </div>
                    <p id="admin-update-status" class="status-message"></p>
                </div>
            </section>
        </main>
    
    </div>
    
    <!-- Loader -->
    <div id="loader" class="loader-overlay" style="display: none;">
        <div class="loader-spinner"></div>
    </div>
    <div id="notification-container"></div>
    
    <!-- T·∫£i Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>

    <!-- T·∫£i c√°c modules c·ªßa ·ª©ng d·ª•ng -->
    <script src="./js/firebase.js" type="module"></script>
    <script src="./js/b2Storage.js" type="module"></script>
    <script src="./js/dom.js" type="module"></script>
    <script src="./js/utils.js" type="module"></script>
    <script src="./js/fontUtils.js" type="module"></script> 
    <script src="./js/notifications.js" type="module"></script>
    <script src="./js/auth.js" type="module"></script>
    <script src="./js/quote.js" type="module"></script>
    <script src="./js/costing.js" type="module"></script>
    <script src="./js/catalog.js" type="module"></script>
    <script src="./js/ui.js" type="module"></script>
    <script src="./js/main.js" type="module"></script>
    <script src="./js/admin.js" type="module"></script>
</body>
</html>